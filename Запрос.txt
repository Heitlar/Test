ВЫБРАТЬ РАЗРЕШЕННЫЕ
	МИНИМУМ(УчастникиПроектовКЦСрезПоследних.Период) КАК ДатаНачала,
	УчастникиПроектовКЦСрезПоследних.ПроектКЦ КАК ПроектКЦ,
	УчастникиПроектовКЦСрезПоследних.Участник КАК Участник,
	МАКСИМУМ(ЕСТЬNULL(УчастникиПроектовКЦСрезПоследнихДатаОкончания.Период, ДАТАВРЕМЯ(3999, 11, 1))) КАК ДатаОкончания
ПОМЕСТИТЬ ВТ_Проекты
ИЗ
	РегистрСведений.УчастникиПроектовКЦ.СрезПоследних(&ДатаОкончания, Прикреплен = ИСТИНА) КАК УчастникиПроектовКЦСрезПоследних
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчастникиПроектовКЦ.СрезПоследних(&ДатаОкончания, Прикреплен = ЛОЖЬ) КАК УчастникиПроектовКЦСрезПоследнихДатаОкончания
		ПО УчастникиПроектовКЦСрезПоследних.ПроектКЦ = УчастникиПроектовКЦСрезПоследнихДатаОкончания.ПроектКЦ
			И УчастникиПроектовКЦСрезПоследних.Участник = УчастникиПроектовКЦСрезПоследнихДатаОкончания.Участник

СГРУППИРОВАТЬ ПО
	УчастникиПроектовКЦСрезПоследних.ПроектКЦ,
	УчастникиПроектовКЦСрезПоследних.Участник
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВзаиморасчетыПоУслугам.Клиника КАК Клиника,
	ВзаиморасчетыПоУслугам.Контрагент КАК Контрагент,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыПоУслугам.Регистратор ССЫЛКА Документ.РасходДенежныхСредств
				ТОГДА -ВзаиморасчетыПоУслугам.Сумма
			ИНАЧЕ ВзаиморасчетыПоУслугам.Сумма
		КОНЕЦ) КАК Сумма
ПОМЕСТИТЬ ВТ_ПациентыСОплатойБольшеПорога
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам КАК ВзаиморасчетыПоУслугам
ГДЕ
	ВзаиморасчетыПоУслугам.Период МЕЖДУ &ДатаНачалаАванса И &ДатаККонецЗадолжность
	И ВзаиморасчетыПоУслугам.ВидОплаты В(&ВидыОплат)

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыПоУслугам.Клиника,
	ВзаиморасчетыПоУслугам.Контрагент

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыПоУслугам.Регистратор ССЫЛКА Документ.РасходДенежныхСредств
				ТОГДА -ВзаиморасчетыПоУслугам.Сумма
			ИНАЧЕ ВзаиморасчетыПоУслугам.Сумма
		КОНЕЦ) >= &ПорогСуммы
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	Продажи.Клиника КАК Клиника,
	Продажи.Контрагент КАК Пациент,
	Продажи.Период КАК Период,
	Продажи.Регистратор КАК Регистратор
ПОМЕСТИТЬ ВТ_КлиникиПациентыПриемы
ИЗ
	РегистрНакопления.Продажи КАК Продажи
ГДЕ
	Продажи.Период МЕЖДУ &ДатаНачалаАванса И &ДатаККонецЗадолжность
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВЫБОР
		КОГДА ВзаиморасчетыПоУслугамОстатки.СуммаОстаток < 0
			ТОГДА -ВзаиморасчетыПоУслугамОстатки.СуммаОстаток
		ИНАЧЕ 0
	КОНЕЦ КАК Аванс,
	ВЫБОР
		КОГДА ВзаиморасчетыПоУслугамОстатки.СуммаОстаток > 0
			ТОГДА ВзаиморасчетыПоУслугамОстатки.СуммаОстаток
		ИНАЧЕ 0
	КОНЕЦ КАК Задолженность,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Клиника КАК Клиника,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Пациент КАК Пациент
ПОМЕСТИТЬ ВТ_Аванс
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам.Остатки(&ДатаККонецЗадолжность, ) КАК ВзаиморасчетыПоУслугамОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДополнительныеСведенияКонтрагентов.СрезПоследних(&ДатаОтчета, ) КАК ДополнительныеСведенияКонтрагентовСрезПоследних
		ПО ВзаиморасчетыПоУслугамОстатки.Клиника = ДополнительныеСведенияКонтрагентовСрезПоследних.Клиника
			И ВзаиморасчетыПоУслугамОстатки.Контрагент = ДополнительныеСведенияКонтрагентовСрезПоследних.Пациент
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВЫБОР
		КОГДА ВзаиморасчетыПоУслугамОстатки.СуммаОстаток < 0
			ТОГДА -ВзаиморасчетыПоУслугамОстатки.СуммаОстаток
		ИНАЧЕ 0
	КОНЕЦ КАК Аванс,
	ВЫБОР
		КОГДА ВзаиморасчетыПоУслугамОстатки.СуммаОстаток > 0
			ТОГДА ВзаиморасчетыПоУслугамОстатки.СуммаОстаток
		ИНАЧЕ 0
	КОНЕЦ КАК Задолженность,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Клиника КАК Клиника,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Пациент КАК Пациент
ПОМЕСТИТЬ ВТ_Задолжность
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам.Остатки(&ДатаККонецЗадолжность, ) КАК ВзаиморасчетыПоУслугамОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДополнительныеСведенияКонтрагентов.СрезПоследних(&ДатаОтчета, ) КАК ДополнительныеСведенияКонтрагентовСрезПоследних
		ПО ВзаиморасчетыПоУслугамОстатки.Клиника = ДополнительныеСведенияКонтрагентовСрезПоследних.Клиника
			И ВзаиморасчетыПоУслугамОстатки.Контрагент = ДополнительныеСведенияКонтрагентовСрезПоследних.Пациент
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ПродажиОбороты.Регистратор КАК Регистратор,
	ПродажиОбороты.Контрагент КАК Пациент,
	ПродажиОбороты.Клиника КАК Клиника,
	ПродажиОбороты.Подразделение КАК Отделение,
	ПродажиОбороты.Номенклатура КАК Услуга,
	СУММА(ПродажиОбороты.СуммаОборот) КАК Сумма,
	СУММА(ПродажиОбороты.СкидкаОборот) КАК Скидка,
	СУММА(ПродажиОбороты.КоличествоОборот) КАК Количество,
	ПродажиОбороты.НомерЗуба КАК НомерЗуба,
	ПродажиОбороты.Сотрудник КАК Сотрудник,
	ПродажиОбороты.ПериодСекунда КАК Период,
	ПродажиОбороты.ПериодЧас КАК ПериодЧас,
	ПродажиОбороты.ПериодДень КАК ПериодДень,
	ПродажиОбороты.ПериодНеделя КАК ПериодНеделя,
	ПродажиОбороты.ПериодДекада КАК ПериодДекада,
	ПродажиОбороты.ПериодМесяц КАК ПериодМесяц,
	ПродажиОбороты.ПериодКвартал КАК ПериодКвартал,
	ПродажиОбороты.ПериодПолугодие КАК ПериодПолугодие,
	ПродажиОбороты.ПериодГод КАК ПериодГод,
	МАКСИМУМ(ПродажиОбороты.ПланЛечения.Врач.ПИН) КАК ПланЛеченияВрачПИН,
	ПродажиОбороты.НомерСтроки КАК НомерСтроки
ПОМЕСТИТЬ ДанныеПродаж
ИЗ
	РегистрНакопления.Продажи.Обороты(
			&ДатаНачала,
			&ДатаОкончания,
			Авто,
			&Клиника = ЛОЖЬ
				ИЛИ Клиника = &Клиника) КАК ПродажиОбороты

СГРУППИРОВАТЬ ПО
	ПродажиОбороты.Сотрудник,
	ПродажиОбороты.Клиника,
	ПродажиОбороты.ПериодСекунда,
	ПродажиОбороты.ПериодЧас,
	ПродажиОбороты.ПериодНеделя,
	ПродажиОбороты.ПериодКвартал,
	ПродажиОбороты.Регистратор,
	ПродажиОбороты.Контрагент,
	ПродажиОбороты.Подразделение,
	ПродажиОбороты.НомерЗуба,
	ПродажиОбороты.ПериодДекада,
	ПродажиОбороты.Номенклатура,
	ПродажиОбороты.ПериодДень,
	ПродажиОбороты.ПериодМесяц,
	ПродажиОбороты.ПериодПолугодие,
	ПродажиОбороты.ПериодГод,
	ПродажиОбороты.НомерСтроки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВзаиморасчетыПоУслугамОстатки.Клиника КАК Клиника,
	ВзаиморасчетыПоУслугамОстатки.Контрагент КАК Контрагент,
	ВзаиморасчетыПоУслугамОстатки.Договор КАК Договор,
	ВзаиморасчетыПоУслугамОстатки.Документ КАК Документ,
	ВзаиморасчетыПоУслугамОстатки.Номенклатура КАК Номенклатура,
	ВзаиморасчетыПоУслугамОстатки.НомерЗуба КАК НомерЗуба,
	ВзаиморасчетыПоУслугамОстатки.СуммаОстаток КАК СуммаОстаток
ПОМЕСТИТЬ ВТ_ДебиторкаНаНачало
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам.Остатки(
			ДОБАВИТЬКДАТЕ(&ДатаНачала, СЕКУНДА, -1),
			&Клиника = ЛОЖЬ
				ИЛИ Клиника = &Клиника) КАК ВзаиморасчетыПоУслугамОстатки
ГДЕ
	ВзаиморасчетыПоУслугамОстатки.СуммаОстаток > 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВзаиморасчетыПоУслугамОбороты.Клиника КАК Клиника,
	ВзаиморасчетыПоУслугамОбороты.Контрагент КАК Контрагент,
	ВзаиморасчетыПоУслугамОбороты.Договор КАК Договор,
	ВзаиморасчетыПоУслугамОбороты.Документ КАК Документ,
	ВзаиморасчетыПоУслугамОбороты.Номенклатура КАК Номенклатура,
	ВзаиморасчетыПоУслугамОбороты.НомерЗуба КАК НомерЗуба,
	ВзаиморасчетыПоУслугамОбороты.СуммаРасход КАК СуммаРасход,
	ВзаиморасчетыПоУслугамОбороты.ПериодСекунда КАК ПериодСекунда,
	ВзаиморасчетыПоУслугамОбороты.ПериодМинута КАК ПериодМинута,
	ВзаиморасчетыПоУслугамОбороты.ПериодЧас КАК ПериодЧас,
	ВзаиморасчетыПоУслугамОбороты.ПериодДень КАК ПериодДень,
	ВзаиморасчетыПоУслугамОбороты.ПериодНеделя КАК ПериодНеделя,
	ВзаиморасчетыПоУслугамОбороты.ПериодДекада КАК ПериодДекада,
	ВзаиморасчетыПоУслугамОбороты.ПериодМесяц КАК ПериодМесяц,
	ВзаиморасчетыПоУслугамОбороты.ПериодКвартал КАК ПериодКвартал,
	ВзаиморасчетыПоУслугамОбороты.ПериодПолугодие КАК ПериодПолугодие,
	ВзаиморасчетыПоУслугамОбороты.ПериодГод КАК ПериодГод
ПОМЕСТИТЬ ВТ_Приход
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам.Обороты(
			&ДатаНачала,
			&ДатаОкончания,
			Авто,
			&Клиника = ЛОЖЬ
				ИЛИ Клиника = &Клиника) КАК ВзаиморасчетыПоУслугамОбороты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ДебиторкаНаНачало.Клиника КАК Клиника,
	ВТ_ДебиторкаНаНачало.Контрагент КАК Контрагент,
	ВТ_ДебиторкаНаНачало.Договор КАК Договор,
	ВТ_ДебиторкаНаНачало.Документ КАК Документ,
	ВТ_ДебиторкаНаНачало.Номенклатура КАК Номенклатура,
	ВТ_ДебиторкаНаНачало.НомерЗуба КАК НомерЗуба,
	СУММА(ВТ_Приход.СуммаРасход) КАК СуммаРасход,
	ВТ_Приход.ПериодСекунда КАК ПериодСекунда,
	ВТ_Приход.ПериодМинута КАК ПериодМинута,
	ВТ_Приход.ПериодЧас КАК ПериодЧас,
	ВТ_Приход.ПериодДень КАК ПериодДень,
	ВТ_Приход.ПериодНеделя КАК ПериодНеделя,
	ВТ_Приход.ПериодДекада КАК ПериодДекада,
	ВТ_Приход.ПериодМесяц КАК ПериодМесяц,
	ВТ_Приход.ПериодКвартал КАК ПериодКвартал,
	ВТ_Приход.ПериодПолугодие КАК ПериодПолугодие,
	ВТ_Приход.ПериодГод КАК ПериодГод
ПОМЕСТИТЬ ВТ_ОплатыПрошлогоПериода
ИЗ
	ВТ_ДебиторкаНаНачало КАК ВТ_ДебиторкаНаНачало
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Приход КАК ВТ_Приход
		ПО ВТ_ДебиторкаНаНачало.Клиника = ВТ_Приход.Клиника
			И ВТ_ДебиторкаНаНачало.Контрагент = ВТ_Приход.Контрагент
			И ВТ_ДебиторкаНаНачало.Договор = ВТ_Приход.Договор
			И ВТ_ДебиторкаНаНачало.Документ = ВТ_Приход.Документ
			И ВТ_ДебиторкаНаНачало.Номенклатура = ВТ_Приход.Номенклатура
			И ВТ_ДебиторкаНаНачало.НомерЗуба = ВТ_Приход.НомерЗуба
ГДЕ
	ВТ_Приход.СуммаРасход ЕСТЬ НЕ NULL 

СГРУППИРОВАТЬ ПО
	ВТ_ДебиторкаНаНачало.Клиника,
	ВТ_ДебиторкаНаНачало.Контрагент,
	ВТ_ДебиторкаНаНачало.Договор,
	ВТ_ДебиторкаНаНачало.Документ,
	ВТ_ДебиторкаНаНачало.Номенклатура,
	ВТ_ДебиторкаНаНачало.НомерЗуба,
	ВТ_Приход.ПериодСекунда,
	ВТ_Приход.ПериодМинута,
	ВТ_Приход.ПериодЧас,
	ВТ_Приход.ПериодДень,
	ВТ_Приход.ПериодНеделя,
	ВТ_Приход.ПериодДекада,
	ВТ_Приход.ПериодМесяц,
	ВТ_Приход.ПериодКвартал,
	ВТ_Приход.ПериодПолугодие,
	ВТ_Приход.ПериодГод
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВзаиморасчетыПоУслугамОбороты.Клиника КАК Клиника,
	ВзаиморасчетыПоУслугамОбороты.Контрагент КАК Контрагент,
	СУММА(ВзаиморасчетыПоУслугамОбороты.СуммаОборот) КАК СуммаОборот
ПОМЕСТИТЬ ВТ_ПлатившиеЗаПериод
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам.Обороты КАК ВзаиморасчетыПоУслугамОбороты

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыПоУслугамОбороты.Клиника,
	ВзаиморасчетыПоУслугамОбороты.Контрагент
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ПланЛечения.Врач КАК Врач,
	ПланЛечения.Пациент КАК Пациент,
	ПланЛечения.Отделение КАК Отделение,
	ПланЛечения.СуммаДокумента КАК СуммаДокумента,
	ПланЛечения.Дата КАК Период,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, ЧАС) КАК ПериодЧас,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, ДЕНЬ) КАК ПериодДень,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, НЕДЕЛЯ) КАК ПериодНеделя,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, ДЕКАДА) КАК ПериодДекада,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, МЕСЯЦ) КАК ПериодМесяц,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, КВАРТАЛ) КАК ПериодКвартал,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, ПОЛУГОДИЕ) КАК ПериодПолугодие,
	НАЧАЛОПЕРИОДА(ПланЛечения.Дата, ГОД) КАК ПериодГод,
	ПланЛечения.Клиника КАК Клиника,
	ПланЛечения.Ссылка КАК Ссылка,
	ДополнительныеСведенияКонтрагентовСрезПоследних.НомерКарты КАК НомерКарты,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ПостфиксНомераКарты КАК ПостфиксНомераКарты
ПОМЕСТИТЬ ВТ_ПланыЛечения
ИЗ
	Документ.ПланЛечения КАК ПланЛечения
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДополнительныеСведенияКонтрагентов.СрезПоследних(ДОБАВИТЬКДАТЕ(&ДатаОкончания, СЕКУНДА, 1), ) КАК ДополнительныеСведенияКонтрагентовСрезПоследних
		ПО ПланЛечения.Клиника = ДополнительныеСведенияКонтрагентовСрезПоследних.Клиника
			И ПланЛечения.Пациент = ДополнительныеСведенияКонтрагентовСрезПоследних.Пациент
ГДЕ
	ПланЛечения.Проведен = ИСТИНА
	И ПланЛечения.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	И (ПланЛечения.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыПлановЛечения.СогласованныйБезПредоплаты)
			ИЛИ ПланЛечения.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыПлановЛечения.СогласованныйСПредоплатой))
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ДанныеПродаж.Клиника КАК Клиника,
	ДанныеПродаж.Пациент КАК Пациент
ПОМЕСТИТЬ ВТ_КлиникиИПациенты
ИЗ
	ДанныеПродаж КАК ДанныеПродаж

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВТ_ПлатившиеЗаПериод.Клиника,
	ВТ_ПлатившиеЗаПериод.Контрагент
ИЗ
	ВТ_ПлатившиеЗаПериод КАК ВТ_ПлатившиеЗаПериод

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВТ_ПланыЛечения.Клиника,
	ВТ_ПланыЛечения.Пациент
ИЗ
	ВТ_ПланыЛечения КАК ВТ_ПланыЛечения

ИНДЕКСИРОВАТЬ ПО
	Клиника,
	Пациент
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДатыПриемаПациентовСрезПервых.Клиника КАК Клиника,
	ДатыПриемаПациентовСрезПервых.Пациент КАК Пациент,
	МИНИМУМ(ДатыПриемаПациентовСрезПервых.ДатаПриема) КАК ДатаПервогоПосещенияКлиники
ПОМЕСТИТЬ ВТ_ПервыеПосещенияКлиник
ИЗ
	РегистрСведений.ДатыПриемаПациентов.СрезПервых(
			,
			(Клиника, Пациент) В
				(ВЫБРАТЬ
					ВТ_КлиникиИПациенты.Клиника КАК Клиника,
					ВТ_КлиникиИПациенты.Пациент КАК Пациент
				ИЗ
					ВТ_КлиникиИПациенты КАК ВТ_КлиникиИПациенты)) КАК ДатыПриемаПациентовСрезПервых

СГРУППИРОВАТЬ ПО
	ДатыПриемаПациентовСрезПервых.Пациент,
	ДатыПриемаПациентовСрезПервых.Клиника
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДатыПриемаПациентовСрезПоследних.Клиника КАК Клиника,
	ДатыПриемаПациентовСрезПоследних.Пациент КАК Пациент,
	МАКСИМУМ(ДатыПриемаПациентовСрезПоследних.ДатаПриема) КАК ДатаПосещенияПередПериодомОтчета
ПОМЕСТИТЬ ВТ_ДатыПосещенияКлиникиПередПериодомОтчета
ИЗ
	РегистрСведений.ДатыПриемаПациентов.СрезПоследних(
			ДОБАВИТЬКДАТЕ(&ДатаНачала, СЕКУНДА, -1),
			(Клиника, Пациент) В
				(ВЫБРАТЬ
					ВТ_КлиникиИПациенты.Клиника КАК Клиника,
					ВТ_КлиникиИПациенты.Пациент КАК Пациент
				ИЗ
					ВТ_КлиникиИПациенты КАК ВТ_КлиникиИПациенты)) КАК ДатыПриемаПациентовСрезПоследних

СГРУППИРОВАТЬ ПО
	ДатыПриемаПациентовСрезПоследних.Пациент,
	ДатыПриемаПациентовСрезПоследних.Клиника
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДанныеПродаж.Пациент КАК Пациент,
	ДанныеПродаж.Клиника КАК Клиника,
	МИНИМУМ(ДанныеПродаж.Период) КАК ДатаПервогоПосещенияКлиникиВПериоде
ПОМЕСТИТЬ ВТ_ПервыеПоявленияВКлиникеВПериоде
ИЗ
	ДанныеПродаж КАК ДанныеПродаж

СГРУППИРОВАТЬ ПО
	ДанныеПродаж.Пациент,
	ДанныеПродаж.Клиника
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ПервыеПосещенияКлиник.Клиника КАК Клиника,
	ВТ_ПервыеПосещенияКлиник.Пациент КАК ПациентПервичный
ПОМЕСТИТЬ ВТ_ПервичныеПациенты
ИЗ
	ВТ_ПервыеПосещенияКлиник КАК ВТ_ПервыеПосещенияКлиник
ГДЕ
	ВТ_ПервыеПосещенияКлиник.ДатаПервогоПосещенияКлиники МЕЖДУ &ДатаНачала И &ДатаОкончания
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ПервыеПоявленияВКлиникеВПериоде.Пациент КАК Пациент,
	ВТ_ПервыеПоявленияВКлиникеВПериоде.Клиника КАК Клиника,
	ВТ_ДатыПосещенияКлиникиПередПериодомОтчета.ДатаПосещенияПередПериодомОтчета КАК ДатаПосещенияПередПериодомОтчета,
	ВТ_ПервыеПоявленияВКлиникеВПериоде.ДатаПервогоПосещенияКлиникиВПериоде КАК ДатаПервогоПосещенияКлиникиВПериоде,
	РАЗНОСТЬДАТ(ВТ_ДатыПосещенияКлиникиПередПериодомОтчета.ДатаПосещенияПередПериодомОтчета, ВТ_ПервыеПоявленияВКлиникеВПериоде.ДатаПервогоПосещенияКлиникиВПериоде, МЕСЯЦ) КАК МесяцевСПоследнегоПосещения
ПОМЕСТИТЬ ВТ_УсловноПервичныеПациенты
ИЗ
	ВТ_ПервыеПоявленияВКлиникеВПериоде КАК ВТ_ПервыеПоявленияВКлиникеВПериоде
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ДатыПосещенияКлиникиПередПериодомОтчета КАК ВТ_ДатыПосещенияКлиникиПередПериодомОтчета
		ПО ВТ_ПервыеПоявленияВКлиникеВПериоде.Клиника = ВТ_ДатыПосещенияКлиникиПередПериодомОтчета.Клиника
			И ВТ_ПервыеПоявленияВКлиникеВПериоде.Пациент = ВТ_ДатыПосещенияКлиникиПередПериодомОтчета.Пациент
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПервичныеПациенты КАК ВТ_ПервичныеПациенты
		ПО ВТ_ПервыеПоявленияВКлиникеВПериоде.Клиника = ВТ_ПервичныеПациенты.Клиника
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ВТ_УсловноПервичныеПациенты.Клиника КАК Клиника,
	ВТ_УсловноПервичныеПациенты.Пациент КАК ПациентУсловноПеривычный12
ПОМЕСТИТЬ ВТ_УсловноПервичные12
ИЗ
	ВТ_УсловноПервичныеПациенты КАК ВТ_УсловноПервичныеПациенты
ГДЕ
	ВТ_УсловноПервичныеПациенты.МесяцевСПоследнегоПосещения > 12
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ВТ_УсловноПервичныеПациенты.Клиника КАК Клиника,
	ВТ_УсловноПервичныеПациенты.Пациент КАК ПациентУсловноПеривычный6
ПОМЕСТИТЬ ВТ_УсловноПервичные6
ИЗ
	ВТ_УсловноПервичныеПациенты КАК ВТ_УсловноПервичныеПациенты
ГДЕ
	ВТ_УсловноПервичныеПациенты.МесяцевСПоследнегоПосещения МЕЖДУ 7 И 12
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДополнительныеСведенияКонтрагентовСрезПоследних.Клиника КАК Клиника,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Пациент КАК Пациент,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ИсточникИнформации КАК ИсточникИнформации,
	ДополнительныеСведенияКонтрагентовСрезПоследних.НаправленОт КАК НаправленОт,
	ДополнительныеСведенияКонтрагентовСрезПоследних.НаправленК КАК НаправленК,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Период КАК Период,
	ДополнительныеСведенияКонтрагентовСрезПоследних.НомерКарты КАК НомерКарты,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ДатаКарты КАК ДатаКарты,
	ДополнительныеСведенияКонтрагентовСрезПоследних.НомерДоговора КАК НомерДоговора,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ДатаДоговора КАК ДатаДоговора,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Ответственный КАК Ответственный,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ТекущийМенеджер КАК ТекущийМенеджер,
	ДополнительныеСведенияКонтрагентовСрезПоследних.МестонахождениеКарты КАК МестонахождениеКарты,
	ДополнительныеСведенияКонтрагентовСрезПоследних.КатегорияКонтрагента КАК КатегорияКонтрагента,
	ДополнительныеСведенияКонтрагентовСрезПоследних.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Комментарий КАК Комментарий,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ЗаписьНаПриемЗапрещена КАК ЗаписьНаПриемЗапрещена,
	ДополнительныеСведенияКонтрагентовСрезПоследних.НапоминатьОДнеРождения КАК НапоминатьОДнеРождения,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ЗапретЗвонков КАК ЗапретЗвонков,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ЗапретEMailРассылки КАК ЗапретEMailРассылки,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ЗапретSMSРассылки КАК ЗапретSMSРассылки,
	ДополнительныеСведенияКонтрагентовСрезПоследних.СтрокаВсехТегов КАК СтрокаВсехТегов,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ДополнительныеСведенияКонтрагентовСрезПоследних.Оператор КАК Оператор,
	ДополнительныеСведенияКонтрагентовСрезПоследних.УточнениеИсточникаИнформации КАК УточнениеИсточникаИнформации,
	ДополнительныеСведенияКонтрагентовСрезПоследних.ОператорКлиники КАК ОператорКлиники
ПОМЕСТИТЬ ВТ_ДополнительныеПараметрыДоПериода
ИЗ
	РегистрСведений.ДополнительныеСведенияКонтрагентов.СрезПоследних(
			ДОБАВИТЬКДАТЕ(&ДатаНачала, СЕКУНДА, -1),
			(Клиника, Пациент) В
				(ВЫБРАТЬ
					ВТ_КлиникиИПациенты.Клиника КАК Клиника,
					ВТ_КлиникиИПациенты.Пациент КАК Пациент
				ИЗ
					ВТ_КлиникиИПациенты КАК ВТ_КлиникиИПациенты)) КАК ДополнительныеСведенияКонтрагентовСрезПоследних
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДополнительныеСведенияКонтрагентов.Период КАК Период,
	ДополнительныеСведенияКонтрагентов.Клиника КАК Клиника,
	ДополнительныеСведенияКонтрагентов.Пациент КАК Пациент,
	ДополнительныеСведенияКонтрагентов.НомерКарты КАК НомерКарты,
	ДополнительныеСведенияКонтрагентов.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ДополнительныеСведенияКонтрагентов.ДатаКарты КАК ДатаКарты,
	ДополнительныеСведенияКонтрагентов.НомерДоговора КАК НомерДоговора,
	ДополнительныеСведенияКонтрагентов.ДатаДоговора КАК ДатаДоговора,
	ДополнительныеСведенияКонтрагентов.Ответственный КАК Ответственный,
	ДополнительныеСведенияКонтрагентов.ТекущийМенеджер КАК ТекущийМенеджер,
	ДополнительныеСведенияКонтрагентов.МестонахождениеКарты КАК МестонахождениеКарты,
	ДополнительныеСведенияКонтрагентов.КатегорияКонтрагента КАК КатегорияКонтрагента,
	ДополнительныеСведенияКонтрагентов.ИсточникИнформации КАК ИсточникИнформации,
	ДополнительныеСведенияКонтрагентов.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
	ДополнительныеСведенияКонтрагентов.НаправленОт КАК НаправленОт,
	ДополнительныеСведенияКонтрагентов.Комментарий КАК Комментарий,
	ДополнительныеСведенияКонтрагентов.ЗаписьНаПриемЗапрещена КАК ЗаписьНаПриемЗапрещена,
	ДополнительныеСведенияКонтрагентов.НапоминатьОДнеРождения КАК НапоминатьОДнеРождения,
	ДополнительныеСведенияКонтрагентов.ЗапретЗвонков КАК ЗапретЗвонков,
	ДополнительныеСведенияКонтрагентов.ЗапретEMailРассылки КАК ЗапретEMailРассылки,
	ДополнительныеСведенияКонтрагентов.ЗапретSMSРассылки КАК ЗапретSMSРассылки,
	ДополнительныеСведенияКонтрагентов.НаправленК КАК НаправленК,
	ДополнительныеСведенияКонтрагентов.Оператор КАК Оператор,
	ДополнительныеСведенияКонтрагентов.УточнениеИсточникаИнформации КАК УточнениеИсточникаИнформации,
	ДополнительныеСведенияКонтрагентов.ОператорКлиники КАК ОператорКлиники,
	ДополнительныеСведенияКонтрагентов.СтрокаВсехТегов КАК СтрокаВсехТегов
ПОМЕСТИТЬ ВТ_ДопСведенияЗаПериод
ИЗ
	РегистрСведений.ДополнительныеСведенияКонтрагентов КАК ДополнительныеСведенияКонтрагентов
ГДЕ
	ДополнительныеСведенияКонтрагентов.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
	И (ДополнительныеСведенияКонтрагентов.Клиника, ДополнительныеСведенияКонтрагентов.Пациент) В
			(ВЫБРАТЬ
				ВТ_КлиникиИПациенты.Клиника КАК Клиника,
				ВТ_КлиникиИПациенты.Пациент КАК Пациент
			ИЗ
				ВТ_КлиникиИПациенты КАК ВТ_КлиникиИПациенты)

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ДополнительныеПараметрыДоПериода.Период,
	ВТ_ДополнительныеПараметрыДоПериода.Клиника,
	ВТ_ДополнительныеПараметрыДоПериода.Пациент,
	ВТ_ДополнительныеПараметрыДоПериода.НомерКарты,
	ВТ_ДополнительныеПараметрыДоПериода.ПостфиксНомераКарты,
	ВТ_ДополнительныеПараметрыДоПериода.ДатаКарты,
	ВТ_ДополнительныеПараметрыДоПериода.НомерДоговора,
	ВТ_ДополнительныеПараметрыДоПериода.ДатаДоговора,
	ВТ_ДополнительныеПараметрыДоПериода.Ответственный,
	ВТ_ДополнительныеПараметрыДоПериода.ТекущийМенеджер,
	ВТ_ДополнительныеПараметрыДоПериода.МестонахождениеКарты,
	ВТ_ДополнительныеПараметрыДоПериода.КатегорияКонтрагента,
	ВТ_ДополнительныеПараметрыДоПериода.ИсточникИнформации,
	ВТ_ДополнительныеПараметрыДоПериода.КомментарийИсточникаИнформации,
	ВТ_ДополнительныеПараметрыДоПериода.НаправленОт,
	ВТ_ДополнительныеПараметрыДоПериода.Комментарий,
	ВТ_ДополнительныеПараметрыДоПериода.ЗаписьНаПриемЗапрещена,
	ВТ_ДополнительныеПараметрыДоПериода.НапоминатьОДнеРождения,
	ВТ_ДополнительныеПараметрыДоПериода.ЗапретЗвонков,
	ВТ_ДополнительныеПараметрыДоПериода.ЗапретEMailРассылки,
	ВТ_ДополнительныеПараметрыДоПериода.ЗапретSMSРассылки,
	ВТ_ДополнительныеПараметрыДоПериода.НаправленК,
	ВТ_ДополнительныеПараметрыДоПериода.Оператор,
	ВТ_ДополнительныеПараметрыДоПериода.УточнениеИсточникаИнформации,
	ВТ_ДополнительныеПараметрыДоПериода.ОператорКлиники,
	ВТ_ДополнительныеПараметрыДоПериода.СтрокаВсехТегов
ИЗ
	ВТ_ДополнительныеПараметрыДоПериода КАК ВТ_ДополнительныеПараметрыДоПериода
ГДЕ
	(ВТ_ДополнительныеПараметрыДоПериода.Клиника, ВТ_ДополнительныеПараметрыДоПериода.Пациент) В
			(ВЫБРАТЬ
				ВТ_КлиникиИПациенты.Клиника КАК Клиника,
				ВТ_КлиникиИПациенты.Пациент КАК Пациент
			ИЗ
				ВТ_КлиникиИПациенты КАК ВТ_КлиникиИПациенты)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ДопСведенияЗаПериод.Клиника КАК Клиника,
	ВТ_ДопСведенияЗаПериод.Пациент КАК Пациент,
	ВТ_ДопСведенияЗаПериод.Период КАК Период
ПОМЕСТИТЬ ВТ_ДатыИзмененияДопСведенийВПериоде
ИЗ
	ВТ_ДопСведенияЗаПериод КАК ВТ_ДопСведенияЗаПериод
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	Левая.Клиника КАК Клиника,
	Левая.Пациент КАК Пациент,
	Левая.Период КАК ДатаНачала,
	МИНИМУМ(ЕСТЬNULL(ДОБАВИТЬКДАТЕ(Правая.Период, СЕКУНДА, -1), ДАТАВРЕМЯ(2999, 12, 31, 23, 59, 59))) КАК ДатаОкончания
ПОМЕСТИТЬ ВТ_ПериодыДействияДопСведений
ИЗ
	ВТ_ДатыИзмененияДопСведенийВПериоде КАК Левая
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ДатыИзмененияДопСведенийВПериоде КАК Правая
		ПО Левая.Клиника = Правая.Клиника
			И Левая.Пациент = Правая.Пациент
			И Левая.Период < Правая.Период

СГРУППИРОВАТЬ ПО
	Левая.Клиника,
	Левая.Пациент,
	Левая.Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ПериодыДействияДопСведений.Клиника КАК Клиника,
	ВТ_ПериодыДействияДопСведений.Пациент КАК Пациент,
	ВТ_ПериодыДействияДопСведений.ДатаНачала КАК ДатаНачала,
	ВТ_ПериодыДействияДопСведений.ДатаОкончания КАК ДатаОкончания,
	ВТ_ДопСведенияЗаПериод.НомерКарты КАК НомерКарты,
	ВТ_ДопСведенияЗаПериод.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВТ_ДопСведенияЗаПериод.ДатаКарты КАК ДатаКарты,
	ВТ_ДопСведенияЗаПериод.НомерДоговора КАК НомерДоговора,
	ВТ_ДопСведенияЗаПериод.ДатаДоговора КАК ДатаДоговора,
	ВТ_ДопСведенияЗаПериод.Ответственный КАК Ответственный,
	ВТ_ДопСведенияЗаПериод.ТекущийМенеджер КАК ТекущийМенеджер,
	ВТ_ДопСведенияЗаПериод.МестонахождениеКарты КАК МестонахождениеКарты,
	ВТ_ДопСведенияЗаПериод.КатегорияКонтрагента КАК КатегорияКонтрагента,
	ВТ_ДопСведенияЗаПериод.ИсточникИнформации КАК ИсточникИнформации,
	ВТ_ДопСведенияЗаПериод.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
	ВТ_ДопСведенияЗаПериод.НаправленОт КАК НаправленОт,
	ВТ_ДопСведенияЗаПериод.Комментарий КАК Комментарий,
	ВТ_ДопСведенияЗаПериод.ЗаписьНаПриемЗапрещена КАК ЗаписьНаПриемЗапрещена,
	ВТ_ДопСведенияЗаПериод.НапоминатьОДнеРождения КАК НапоминатьОДнеРождения,
	ВТ_ДопСведенияЗаПериод.ЗапретЗвонков КАК ЗапретЗвонков,
	ВТ_ДопСведенияЗаПериод.ЗапретEMailРассылки КАК ЗапретEMailРассылки,
	ВТ_ДопСведенияЗаПериод.ЗапретSMSРассылки КАК ЗапретSMSРассылки,
	ВТ_ДопСведенияЗаПериод.НаправленК КАК НаправленК,
	ВТ_ДопСведенияЗаПериод.Оператор КАК Оператор,
	ВТ_ДопСведенияЗаПериод.УточнениеИсточникаИнформации КАК УточнениеИсточникаИнформации,
	ВТ_ДопСведенияЗаПериод.ОператорКлиники КАК ОператорКлиники
ПОМЕСТИТЬ ВТ_ДопСведенияПоПериодамДействия
ИЗ
	ВТ_ПериодыДействияДопСведений КАК ВТ_ПериодыДействияДопСведений
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ДопСведенияЗаПериод КАК ВТ_ДопСведенияЗаПериод
		ПО ВТ_ПериодыДействияДопСведений.Клиника = ВТ_ДопСведенияЗаПериод.Клиника
			И ВТ_ПериодыДействияДопСведений.Пациент = ВТ_ДопСведенияЗаПериод.Пациент
			И ВТ_ПериодыДействияДопСведений.ДатаНачала = ВТ_ДопСведенияЗаПериод.Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДатыПриемовПациентов.Клиника КАК Клиника,
	ДатыПриемовПациентов.Пациент КАК Пациент,
	ДатыПриемовПациентов.ДатаПриема КАК ДатаПриема
ПОМЕСТИТЬ ВТ_ПриемыПациентовПоДням
ИЗ
	(ВЫБРАТЬ
		ДатыПриемаПациентов.Клиника КАК Клиника,
		ДатыПриемаПациентов.Пациент КАК Пациент,
		ДатыПриемаПациентов.ДатаПриема КАК ДатаПриема
	ИЗ
		РегистрСведений.ДатыПриемаПациентов КАК ДатыПриемаПациентов
	ГДЕ
		(ДатыПриемаПациентов.Клиника, ДатыПриемаПациентов.Пациент) В
				(ВЫБРАТЬ
					ВТ_КлиникиИПациенты.Клиника КАК Клиника,
					ВТ_КлиникиИПациенты.Пациент КАК Пациент
				ИЗ
					ВТ_КлиникиИПациенты КАК ВТ_КлиникиИПациенты)
		И ДатыПриемаПациентов.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
	
	СГРУППИРОВАТЬ ПО
		ДатыПриемаПациентов.Пациент,
		ДатыПриемаПациентов.ДатаПриема,
		ДатыПриемаПациентов.Клиника
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ВТ_ДатыПосещенияКлиникиПередПериодомОтчета.Клиника,
		ВТ_ДатыПосещенияКлиникиПередПериодомОтчета.Пациент,
		ВТ_ДатыПосещенияКлиникиПередПериодомОтчета.ДатаПосещенияПередПериодомОтчета
	ИЗ
		ВТ_ДатыПосещенияКлиникиПередПериодомОтчета КАК ВТ_ДатыПосещенияКлиникиПередПериодомОтчета) КАК ДатыПриемовПациентов
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	СверткаДанныхПоПериодамПосещений.Клиника КАК Клиника,
	СверткаДанныхПоПериодамПосещений.Пациент КАК Пациент,
	СверткаДанныхПоПериодамПосещений.ДатаПредыдущего КАК ДатаПредыдущего,
	СверткаДанныхПоПериодамПосещений.ДатаТекущегоПриема КАК ДатаТекущегоПриема,
	ЕСТЬNULL(РАЗНОСТЬДАТ(СверткаДанныхПоПериодамПосещений.ДатаПредыдущего, СверткаДанныхПоПериодамПосещений.ДатаТекущегоПриема, МЕСЯЦ), 10000) КАК МесяцевМеждуПриемами
ПОМЕСТИТЬ ВТ_СостояниеПациентовПоПериодам
ИЗ
	(ВЫБРАТЬ
		Левая.Клиника КАК Клиника,
		Левая.Пациент КАК Пациент,
		МАКСИМУМ(Правая.ДатаПриема) КАК ДатаПредыдущего,
		Левая.ДатаПриема КАК ДатаТекущегоПриема
	ИЗ
		ВТ_ПриемыПациентовПоДням КАК Левая
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПриемыПациентовПоДням КАК Правая
			ПО Левая.Клиника = Правая.Клиника
				И Левая.Пациент = Правая.Пациент
				И Левая.ДатаПриема > Правая.ДатаПриема
	
	СГРУППИРОВАТЬ ПО
		Левая.Клиника,
		Левая.Пациент,
		Левая.ДатаПриема) КАК СверткаДанныхПоПериодамПосещений
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ДанныеПродаж.Клиника КАК Клиника,
	ДанныеПродаж.Пациент КАК Пациент,
	ДанныеПродаж.Сотрудник КАК Сотрудник
ПОМЕСТИТЬ ВТ_КлиникиВрачиИПациенты
ИЗ
	ДанныеПродаж КАК ДанныеПродаж

ИНДЕКСИРОВАТЬ ПО
	Клиника,
	Пациент
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДатыПриемаПациентовСрезПоследних.Клиника КАК Клиника,
	ДатыПриемаПациентовСрезПоследних.Пациент КАК Пациент,
	ДатыПриемаПациентовСрезПоследних.Врач КАК Врач,
	МАКСИМУМ(ДатыПриемаПациентовСрезПоследних.ДатаПриема) КАК ДатаПосещенияПередПериодомОтчета
ПОМЕСТИТЬ ВТ_ДатыПосещенияВрачаПередПериодомОтчета
ИЗ
	РегистрСведений.ДатыПриемаПациентов.СрезПоследних(
			ДОБАВИТЬКДАТЕ(&ДатаНачала, СЕКУНДА, -1),
			(Клиника, Пациент, Врач) В
				(ВЫБРАТЬ
					ВТ_КлиникиВрачиИПациенты.Клиника КАК Клиника,
					ВТ_КлиникиВрачиИПациенты.Пациент КАК Пациент,
					ВТ_КлиникиВрачиИПациенты.Сотрудник КАК Врач
				ИЗ
					ВТ_КлиникиВрачиИПациенты КАК ВТ_КлиникиВрачиИПациенты)) КАК ДатыПриемаПациентовСрезПоследних

СГРУППИРОВАТЬ ПО
	ДатыПриемаПациентовСрезПоследних.Пациент,
	ДатыПриемаПациентовСрезПоследних.Клиника,
	ДатыПриемаПациентовСрезПоследних.Врач
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ДатыПриемовПациентов.Клиника КАК Клиника,
	ДатыПриемовПациентов.Пациент КАК Пациент,
	ДатыПриемовПациентов.ДатаПриема КАК ДатаПриема,
	ДатыПриемовПациентов.Врач КАК Врач
ПОМЕСТИТЬ ВТ_ПриемыПациентовУВрачаПоДням
ИЗ
	(ВЫБРАТЬ
		ДатыПриемаПациентов.Клиника КАК Клиника,
		ДатыПриемаПациентов.Пациент КАК Пациент,
		ДатыПриемаПациентов.ДатаПриема КАК ДатаПриема,
		ДатыПриемаПациентов.Врач КАК Врач
	ИЗ
		РегистрСведений.ДатыПриемаПациентов КАК ДатыПриемаПациентов
	ГДЕ
		(ДатыПриемаПациентов.Клиника, ДатыПриемаПациентов.Пациент, ДатыПриемаПациентов.Врач) В
				(ВЫБРАТЬ
					ВТ_КлиникиВрачиИПациенты.Клиника КАК Клиника,
					ВТ_КлиникиВрачиИПациенты.Пациент КАК Пациент,
					ВТ_КлиникиВрачиИПациенты.Сотрудник КАК Сотрудник
				ИЗ
					ВТ_КлиникиВрачиИПациенты КАК ВТ_КлиникиВрачиИПациенты)
		И ДатыПриемаПациентов.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
	
	СГРУППИРОВАТЬ ПО
		ДатыПриемаПациентов.Пациент,
		ДатыПриемаПациентов.ДатаПриема,
		ДатыПриемаПациентов.Клиника,
		ДатыПриемаПациентов.Врач
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ВТ_ДатыПосещенияВрачаПередПериодомОтчета.Клиника,
		ВТ_ДатыПосещенияВрачаПередПериодомОтчета.Пациент,
		ВТ_ДатыПосещенияВрачаПередПериодомОтчета.ДатаПосещенияПередПериодомОтчета,
		ВТ_ДатыПосещенияВрачаПередПериодомОтчета.Врач
	ИЗ
		ВТ_ДатыПосещенияВрачаПередПериодомОтчета КАК ВТ_ДатыПосещенияВрачаПередПериодомОтчета) КАК ДатыПриемовПациентов
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	СверткаДанныхПоПериодамПосещений.Клиника КАК Клиника,
	СверткаДанныхПоПериодамПосещений.Пациент КАК Пациент,
	СверткаДанныхПоПериодамПосещений.ДатаПредыдущего КАК ДатаПредыдущего,
	СверткаДанныхПоПериодамПосещений.ДатаТекущегоПриема КАК ДатаТекущегоПриема,
	ЕСТЬNULL(РАЗНОСТЬДАТ(СверткаДанныхПоПериодамПосещений.ДатаПредыдущего, СверткаДанныхПоПериодамПосещений.ДатаТекущегоПриема, МЕСЯЦ), 10000) КАК МесяцевМеждуПриемамиУВрача,
	СверткаДанныхПоПериодамПосещений.Врач КАК Врач
ПОМЕСТИТЬ ВТ_СостояниеПациентовУВрачаПоПериодам
ИЗ
	(ВЫБРАТЬ
		Левая.Клиника КАК Клиника,
		Левая.Пациент КАК Пациент,
		МАКСИМУМ(Правая.ДатаПриема) КАК ДатаПредыдущего,
		Левая.ДатаПриема КАК ДатаТекущегоПриема,
		Левая.Врач КАК Врач
	ИЗ
		ВТ_ПриемыПациентовУВрачаПоДням КАК Левая
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПриемыПациентовУВрачаПоДням КАК Правая
			ПО Левая.Клиника = Правая.Клиника
				И Левая.Пациент = Правая.Пациент
				И Левая.ДатаПриема > Правая.ДатаПриема
				И Левая.Врач = Правая.Врач
	
	СГРУППИРОВАТЬ ПО
		Левая.Клиника,
		Левая.Пациент,
		Левая.ДатаПриема,
		Левая.Врач) КАК СверткаДанныхПоПериодамПосещений
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВзаиморасчетыПоУслугамОстатки.Клиника КАК Клиника,
	ВзаиморасчетыПоУслугамОстатки.Контрагент КАК Контрагент,
	ВзаиморасчетыПоУслугамОстатки.Договор КАК Договор,
	ВзаиморасчетыПоУслугамОстатки.Документ КАК Документ,
	ВзаиморасчетыПоУслугамОстатки.Номенклатура КАК Номенклатура,
	ВзаиморасчетыПоУслугамОстатки.НомерЗуба КАК НомерЗуба,
	ВзаиморасчетыПоУслугамОстатки.СуммаОстаток КАК СуммаОстаток
ПОМЕСТИТЬ ВТ_Оплаты
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам.Остатки(
			&ДатаОкончания,
			(Клиника, Контрагент) В
				(ВЫБРАТЬ
					ВТ_КлиникиИПациенты.Клиника КАК Клиника,
					ВТ_КлиникиИПациенты.Пациент КАК Пациент
				ИЗ
					ВТ_КлиникиИПациенты КАК ВТ_КлиникиИПациенты)) КАК ВзаиморасчетыПоУслугамОстатки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ОплатыПрошлогоПериода.Клиника КАК Клиника,
	ВТ_ОплатыПрошлогоПериода.Контрагент КАК Контрагент,
	ВТ_ОплатыПрошлогоПериода.Договор КАК Договор,
	ВТ_ОплатыПрошлогоПериода.Документ КАК Документ,
	ВТ_ОплатыПрошлогоПериода.Номенклатура КАК Номенклатура,
	ВТ_ОплатыПрошлогоПериода.НомерЗуба КАК НомерЗуба,
	ВТ_ОплатыПрошлогоПериода.СуммаРасход КАК СуммаРасход,
	ВТ_ОплатыПрошлогоПериода.ПериодСекунда КАК ПериодСекунда,
	ВТ_ОплатыПрошлогоПериода.ПериодМинута КАК ПериодМинута,
	ВТ_ОплатыПрошлогоПериода.ПериодЧас КАК ПериодЧас,
	ВТ_ОплатыПрошлогоПериода.ПериодДень КАК ПериодДень,
	ВТ_ОплатыПрошлогоПериода.ПериодНеделя КАК ПериодНеделя,
	ВТ_ОплатыПрошлогоПериода.ПериодДекада КАК ПериодДекада,
	ВТ_ОплатыПрошлогоПериода.ПериодМесяц КАК ПериодМесяц,
	ВТ_ОплатыПрошлогоПериода.ПериодКвартал КАК ПериодКвартал,
	ВТ_ОплатыПрошлогоПериода.ПериодПолугодие КАК ПериодПолугодие,
	ВТ_ОплатыПрошлогоПериода.ПериодГод КАК ПериодГод,
	ПродажиОбороты.Подразделение КАК Подразделение,
	ПродажиОбороты.Сотрудник КАК Сотрудник,
	ПродажиОбороты.ПланЛечения КАК ПланЛечения
ПОМЕСТИТЬ ВТ_ОплатыДолговЗаПрошлыйПериод
ИЗ
	ВТ_ОплатыПрошлогоПериода КАК ВТ_ОплатыПрошлогоПериода
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты(, &ДатаНачала, Регистратор, ) КАК ПродажиОбороты
		ПО ВТ_ОплатыПрошлогоПериода.Клиника = ПродажиОбороты.Клиника
			И ВТ_ОплатыПрошлогоПериода.Контрагент = ПродажиОбороты.Контрагент
			И ВТ_ОплатыПрошлогоПериода.Документ = ПродажиОбороты.Регистратор
			И ВТ_ОплатыПрошлогоПериода.Номенклатура = ПродажиОбороты.Номенклатура
			И ВТ_ОплатыПрошлогоПериода.НомерЗуба = ПродажиОбороты.НомерЗуба
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВзаиморасчетыПоУслугам.Клиника КАК Клиника,
	ВзаиморасчетыПоУслугам.Контрагент КАК Контрагент,
	ВЫБОР
		КОГДА ВзаиморасчетыПоУслугам.Регистратор ССЫЛКА Документ.РасходДенежныхСредств
			ТОГДА -ВзаиморасчетыПоУслугам.Сумма
		ИНАЧЕ ВзаиморасчетыПоУслугам.Сумма
	КОНЕЦ КАК Сумма,
	ВзаиморасчетыПоУслугам.ВидОплаты КАК ВидОплаты,
	ВзаиморасчетыПоУслугам.Регистратор КАК Регистратор,
	ВзаиморасчетыПоУслугам.Период КАК Период,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, ЧАС) КАК ПериодЧас,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, ДЕНЬ) КАК ПериодДень,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, НЕДЕЛЯ) КАК ПериодНеделя,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, ДЕКАДА) КАК ПериодДекада,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, МЕСЯЦ) КАК ПериодМесяц,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, КВАРТАЛ) КАК ПериодКвартал,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, ПОЛУГОДИЕ) КАК ПериодПолугодие,
	НАЧАЛОПЕРИОДА(ВзаиморасчетыПоУслугам.Период, ГОД) КАК ПериодГод
ПОМЕСТИТЬ ВТ_ВнесениДС
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам КАК ВзаиморасчетыПоУслугам
ГДЕ
	ВзаиморасчетыПоУслугам.Период >= &ДатаНачала
	И ВзаиморасчетыПоУслугам.ВидОплаты В(&ВидОплаты)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	Номенклатура.Ссылка КАК НоменклатураПредоп
ПОМЕСТИТЬ ВТ_ПредопределНом
ИЗ
	Справочник.Номенклатура КАК Номенклатура
ГДЕ
	Номенклатура.Предопределенный = ИСТИНА
	И Номенклатура.ПометкаУдаления = ЛОЖЬ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВзаиморасчетыПоУслугам.Клиника КАК Клиника,
	ВзаиморасчетыПоУслугам.Контрагент КАК Контрагент,
	ВзаиморасчетыПоУслугам.Документ КАК Документ,
	ВзаиморасчетыПоУслугам.Номенклатура КАК Номенклатура,
	СУММА(ВзаиморасчетыПоУслугам.Сумма) КАК СуммаОплатыБаллами
ПОМЕСТИТЬ ВТ_ОплатаБаллами
ИЗ
	РегистрНакопления.ВзаиморасчетыПоУслугам КАК ВзаиморасчетыПоУслугам
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПредопределНом КАК ВТ_ПредопределНом
		ПО ВзаиморасчетыПоУслугам.Номенклатура = ВТ_ПредопределНом.НоменклатураПредоп
ГДЕ
	ВзаиморасчетыПоУслугам.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
	И ВзаиморасчетыПоУслугам.ВидОплаты = &ВидОплатыБаллы
	И ВТ_ПредопределНом.НоменклатураПредоп ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыПоУслугам.Клиника,
	ВзаиморасчетыПоУслугам.Контрагент,
	ВзаиморасчетыПоУслугам.Документ,
	ВзаиморасчетыПоУслугам.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВложенныйЗапрос.Регистратор КАК Регистратор,
	ВложенныйЗапрос.Пациент КАК Пациент,
	ВложенныйЗапрос.Клиника КАК Клиника,
	ВложенныйЗапрос.Отделение КАК Отделение,
	ВложенныйЗапрос.Услуга КАК Услуга,
	ВложенныйЗапрос.СуммаОказаныхУслуг КАК СуммаОказаныхУслуг,
	ВложенныйЗапрос.СуммаСкидки КАК СуммаСкидки,
	ВложенныйЗапрос.КоличествоУслуг КАК КоличествоУслуг,
	ВложенныйЗапрос.НомерЗуба КАК НомерЗуба,
	ВложенныйЗапрос.Сотрудник КАК Сотрудник,
	ВложенныйЗапрос.Период КАК Период,
	ВложенныйЗапрос.ПериодЧас КАК ПериодЧас,
	ВложенныйЗапрос.ПериодДень КАК ПериодДень,
	ВложенныйЗапрос.ПериодНеделя КАК ПериодНеделя,
	ВложенныйЗапрос.ПериодДекада КАК ПериодДекада,
	ВложенныйЗапрос.ПериодМесяц КАК ПериодМесяц,
	ВложенныйЗапрос.ПериодКвартал КАК ПериодКвартал,
	ВложенныйЗапрос.ПериодПолугодие КАК ПериодПолугодие,
	ВложенныйЗапрос.ПериодГод КАК ПериодГод,
	ВложенныйЗапрос.КоличествоПациентов КАК КоличествоПациентов,
	ВложенныйЗапрос.ПациентПервичный КАК ПациентПервичный,
	ВложенныйЗапрос.ПациентУсловноПеривычный6 КАК ПациентУсловноПеривычный6,
	ВложенныйЗапрос.ПациентУсловноПеривычный12 КАК ПациентУсловноПеривычный12,
	ВложенныйЗапрос.ИсточникИнформации КАК ИсточникИнформации,
	ВложенныйЗапрос.НаправленОт КАК НаправленОт,
	ВложенныйЗапрос.НаправленК КАК НаправленК,
	ВложенныйЗапрос.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
	ВложенныйЗапрос.МесяцевМеждуПриемами КАК МесяцевМеждуПриемами,
	ВложенныйЗапрос.МесяцевМеждуПриемамиУВрача КАК МесяцевМеждуПриемамиУВрача,
	ВложенныйЗапрос.СуммаОплат КАК СуммаОплат,
	ВложенныйЗапрос.СуммаОплатыДолга КАК СуммаОплатыДолга,
	ВложенныйЗапрос.СуммаПланаЛечения КАК СуммаПланаЛечения,
	ВложенныйЗапрос.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВложенныйЗапрос.НомерКарты КАК НомерКарты,
	ВложенныйЗапрос.СуммаВнесеноЗаПериод КАК СуммаВнесеноЗаПериод,
	ВложенныйЗапрос.ПланЛеченияВрачПИН КАК ПланЛеченияВрачПИН,
	ВложенныйЗапрос.НомерСтроки КАК НомерСтроки
ПОМЕСТИТЬ ВТ_Финал
ИЗ
	(ВЫБРАТЬ
		ДанныеПродаж.Регистратор КАК Регистратор,
		ДанныеПродаж.Пациент КАК Пациент,
		ДанныеПродаж.Клиника КАК Клиника,
		ДанныеПродаж.Отделение КАК Отделение,
		ДанныеПродаж.Услуга КАК Услуга,
		ДанныеПродаж.Сумма КАК СуммаОказаныхУслуг,
		ДанныеПродаж.Скидка КАК СуммаСкидки,
		ДанныеПродаж.Количество КАК КоличествоУслуг,
		ДанныеПродаж.НомерЗуба КАК НомерЗуба,
		ДанныеПродаж.Сотрудник КАК Сотрудник,
		ДанныеПродаж.Период КАК Период,
		ДанныеПродаж.ПериодЧас КАК ПериодЧас,
		ДанныеПродаж.ПериодДень КАК ПериодДень,
		ДанныеПродаж.ПериодНеделя КАК ПериодНеделя,
		ДанныеПродаж.ПериодДекада КАК ПериодДекада,
		ДанныеПродаж.ПериодМесяц КАК ПериодМесяц,
		ДанныеПродаж.ПериодКвартал КАК ПериодКвартал,
		ДанныеПродаж.ПериодПолугодие КАК ПериодПолугодие,
		ДанныеПродаж.ПериодГод КАК ПериодГод,
		ДанныеПродаж.Пациент КАК КоличествоПациентов,
		ВТ_ПервичныеПациенты.ПациентПервичный КАК ПациентПервичный,
		ВТ_УсловноПервичные6.ПациентУсловноПеривычный6 КАК ПациентУсловноПеривычный6,
		ВТ_УсловноПервичные12.ПациентУсловноПеривычный12 КАК ПациентУсловноПеривычный12,
		ВТ_ДопСведенияПоПериодамДействия.ИсточникИнформации КАК ИсточникИнформации,
		ВТ_ДопСведенияПоПериодамДействия.НаправленОт КАК НаправленОт,
		ВТ_ДопСведенияПоПериодамДействия.НаправленК КАК НаправленК,
		ВТ_ДопСведенияПоПериодамДействия.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
		ВТ_СостояниеПациентовПоПериодам.МесяцевМеждуПриемами КАК МесяцевМеждуПриемами,
		ВТ_СостояниеПациентовУВрачаПоПериодам.МесяцевМеждуПриемамиУВрача КАК МесяцевМеждуПриемамиУВрача,
		ВЫБОР
			КОГДА ВТ_Оплаты.СуммаОстаток ЕСТЬ NULL
				ТОГДА ДанныеПродаж.Сумма
			ИНАЧЕ ДанныеПродаж.Сумма - ВТ_Оплаты.СуммаОстаток
		КОНЕЦ КАК СуммаОплат,
		0 КАК СуммаОплатыДолга,
		0 КАК СуммаПланаЛечения,
		ВТ_ДопСведенияПоПериодамДействия.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
		ВТ_ДопСведенияПоПериодамДействия.НомерКарты КАК НомерКарты,
		NULL КАК СуммаВнесеноЗаПериод,
		ДанныеПродаж.ПланЛеченияВрачПИН КАК ПланЛеченияВрачПИН,
		NULL КАК ПланЛечения,
		ДанныеПродаж.НомерСтроки КАК НомерСтроки
	ИЗ
		ДанныеПродаж КАК ДанныеПродаж
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПервичныеПациенты КАК ВТ_ПервичныеПациенты
			ПО ДанныеПродаж.Клиника = ВТ_ПервичныеПациенты.Клиника
				И ДанныеПродаж.Пациент = ВТ_ПервичныеПациенты.ПациентПервичный
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УсловноПервичные6 КАК ВТ_УсловноПервичные6
			ПО ДанныеПродаж.Клиника = ВТ_УсловноПервичные6.Клиника
				И ДанныеПродаж.Пациент = ВТ_УсловноПервичные6.ПациентУсловноПеривычный6
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_УсловноПервичные12 КАК ВТ_УсловноПервичные12
			ПО ДанныеПродаж.Клиника = ВТ_УсловноПервичные12.Клиника
				И ДанныеПродаж.Пациент = ВТ_УсловноПервичные12.ПациентУсловноПеривычный12
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ДопСведенияПоПериодамДействия КАК ВТ_ДопСведенияПоПериодамДействия
			ПО ДанныеПродаж.Клиника = ВТ_ДопСведенияПоПериодамДействия.Клиника
				И ДанныеПродаж.Пациент = ВТ_ДопСведенияПоПериодамДействия.Пациент
				И ДанныеПродаж.Период >= ВТ_ДопСведенияПоПериодамДействия.ДатаНачала
				И ДанныеПродаж.Период <= ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СостояниеПациентовПоПериодам КАК ВТ_СостояниеПациентовПоПериодам
			ПО ДанныеПродаж.Клиника = ВТ_СостояниеПациентовПоПериодам.Клиника
				И ДанныеПродаж.Пациент = ВТ_СостояниеПациентовПоПериодам.Пациент
				И ДанныеПродаж.ПериодДень = ВТ_СостояниеПациентовПоПериодам.ДатаТекущегоПриема
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СостояниеПациентовУВрачаПоПериодам КАК ВТ_СостояниеПациентовУВрачаПоПериодам
			ПО ДанныеПродаж.Клиника = ВТ_СостояниеПациентовУВрачаПоПериодам.Клиника
				И ДанныеПродаж.Пациент = ВТ_СостояниеПациентовУВрачаПоПериодам.Пациент
				И ДанныеПродаж.Сотрудник = ВТ_СостояниеПациентовУВрачаПоПериодам.Врач
				И ДанныеПродаж.ПериодДень = ВТ_СостояниеПациентовУВрачаПоПериодам.ДатаТекущегоПриема
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Оплаты КАК ВТ_Оплаты
			ПО ДанныеПродаж.Клиника = ВТ_Оплаты.Клиника
				И ДанныеПродаж.Пациент = ВТ_Оплаты.Контрагент
				И ДанныеПродаж.Услуга = ВТ_Оплаты.Номенклатура
				И ДанныеПродаж.Регистратор = ВТ_Оплаты.Документ
				И ДанныеПродаж.НомерЗуба = ВТ_Оплаты.НомерЗуба
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ВТ_ОплатыДолговЗаПрошлыйПериод.Документ,
		ВТ_ОплатыДолговЗаПрошлыйПериод.Контрагент,
		ВТ_ОплатыДолговЗаПрошлыйПериод.Клиника,
		ВТ_ОплатыДолговЗаПрошлыйПериод.Подразделение,
		ВТ_ОплатыДолговЗаПрошлыйПериод.Номенклатура,
		0,
		0,
		0,
		ВТ_ОплатыДолговЗаПрошлыйПериод.НомерЗуба,
		ВТ_ОплатыДолговЗаПрошлыйПериод.Сотрудник,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодСекунда,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодЧас,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодДень,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодНеделя,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодДекада,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодМесяц,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодКвартал,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодПолугодие,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПериодГод,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		0,
		0,
		0,
		ВТ_ОплатыДолговЗаПрошлыйПериод.СуммаРасход,
		0,
		NULL,
		NULL,
		NULL,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПланЛечения.Врач.ПИН,
		ВТ_ОплатыДолговЗаПрошлыйПериод.ПланЛечения,
		NULL
	ИЗ
		ВТ_ОплатыДолговЗаПрошлыйПериод КАК ВТ_ОплатыДолговЗаПрошлыйПериод
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ВТ_ПланыЛечения.Ссылка,
		ВТ_ПланыЛечения.Пациент,
		ВТ_ПланыЛечения.Клиника,
		ВТ_ПланыЛечения.Отделение,
		NULL,
		0,
		0,
		0,
		NULL,
		ВТ_ПланыЛечения.Врач,
		ВТ_ПланыЛечения.Период,
		ВТ_ПланыЛечения.ПериодЧас,
		ВТ_ПланыЛечения.ПериодДень,
		ВТ_ПланыЛечения.ПериодНеделя,
		ВТ_ПланыЛечения.ПериодДекада,
		ВТ_ПланыЛечения.ПериодМесяц,
		ВТ_ПланыЛечения.ПериодКвартал,
		ВТ_ПланыЛечения.ПериодПолугодие,
		ВТ_ПланыЛечения.ПериодГод,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		0,
		0,
		0,
		NULL,
		ВТ_ПланыЛечения.СуммаДокумента,
		ВТ_ПланыЛечения.ПостфиксНомераКарты,
		ВТ_ПланыЛечения.НомерКарты,
		NULL,
		ВТ_ПланыЛечения.Врач.ПИН,
		NULL,
		NULL
	ИЗ
		ВТ_ПланыЛечения КАК ВТ_ПланыЛечения
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ВТ_ВнесениДС.Регистратор,
		ВТ_ВнесениДС.Контрагент,
		ВТ_ВнесениДС.Клиника,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		ВТ_ВнесениДС.Период,
		ВТ_ВнесениДС.ПериодЧас,
		ВТ_ВнесениДС.ПериодДень,
		ВТ_ВнесениДС.ПериодНеделя,
		ВТ_ВнесениДС.ПериодДекада,
		ВТ_ВнесениДС.ПериодМесяц,
		ВТ_ВнесениДС.ПериодКвартал,
		ВТ_ВнесениДС.ПериодПолугодие,
		ВТ_ВнесениДС.ПериодГод,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		ВТ_ВнесениДС.Сумма,
		NULL,
		NULL,
		NULL
	ИЗ
		ВТ_ВнесениДС КАК ВТ_ВнесениДС
	ГДЕ
		ВТ_ВнесениДС.Период МЕЖДУ &ДатаНачала И &ДатаОкончания) КАК ВложенныйЗапрос
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_Финал.Регистратор КАК Регистратор,
	ВТ_Финал.Регистратор.Менеджер КАК Менеджер,
	ВТ_Финал.Пациент КАК Пациент,
	ВТ_Финал.Клиника КАК Клиника,
	ВТ_Финал.Отделение КАК Отделение,
	ВТ_Финал.Услуга КАК Услуга,
	ВТ_Финал.Услуга.Артикул КАК Артикул,
	ВТ_Финал.СуммаОказаныхУслуг КАК СуммаОказаныхУслуг,
	ВТ_Финал.СуммаСкидки КАК СуммаСкидки,
	ВТ_Финал.КоличествоУслуг КАК КоличествоУслуг,
	ВТ_Финал.НомерЗуба КАК НомерЗуба,
	ВТ_Финал.Сотрудник КАК Сотрудник,
	ВТ_Финал.Период КАК Период,
	ВТ_Финал.ПериодЧас КАК ПериодЧас,
	ВТ_Финал.ПериодДень КАК ПериодДень,
	ВТ_Финал.ПериодНеделя КАК ПериодНеделя,
	ВТ_Финал.ПериодДекада КАК ПериодДекада,
	ВТ_Финал.ПериодМесяц КАК ПериодМесяц,
	ВТ_Финал.ПериодКвартал КАК ПериодКвартал,
	ВТ_Финал.ПериодПолугодие КАК ПериодПолугодие,
	ВТ_Финал.ПериодГод КАК ПериодГод,
	ВТ_Финал.КоличествоПациентов КАК КоличествоПациентов,
	ВТ_Финал.ПациентПервичный КАК ПациентПервичный,
	ВТ_Финал.ПациентУсловноПеривычный6 КАК ПациентУсловноПеривычный6,
	ВТ_Финал.ПациентУсловноПеривычный12 КАК ПациентУсловноПеривычный12,
	ВТ_Финал.ИсточникИнформации КАК ИсточникИнформации,
	ВТ_Финал.НаправленОт КАК НаправленОт,
	ВТ_Финал.НаправленК КАК НаправленК,
	ВТ_Финал.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
	ВТ_Финал.МесяцевМеждуПриемами КАК МесяцевМеждуПриемами,
	ВТ_Финал.МесяцевМеждуПриемамиУВрача КАК МесяцевМеждуПриемамиУВрача,
	ВТ_Финал.СуммаОплат КАК СуммаОплат,
	ВТ_Финал.СуммаОплатыДолга КАК СуммаОплатыДолга,
	ВТ_Финал.СуммаПланаЛечения КАК СуммаПланаЛечения,
	ВЫБОР
		КОГДА ВТ_Финал.ПациентПервичный ССЫЛКА Справочник.Контрагенты
			ТОГДА ВЫБОР
					КОГДА ВТ_Финал.СуммаОказаныхУслуг > 0
								И ВТ_Финал.СуммаОплат > 0
							ИЛИ ВТ_Финал.СуммаОказаныхУслуг = 0
						ТОГДА 2
					ИНАЧЕ 1
				КОНЕЦ
		ИНАЧЕ ""
	КОНЕЦ КАК Первичный,
	ВТ_Финал.Регистратор.Комментарий КАК Комментарии,
	ВТ_Финал.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВТ_Финал.НомерКарты КАК НомерКарты,
	ВТ_Финал.СуммаВнесеноЗаПериод КАК СуммаВнесеноЗаПериод,
	ВТ_ОплатаБаллами.СуммаОплатыБаллами КАК СуммаОплатыБаллами,
	ВТ_Финал.ПланЛеченияВрачПИН КАК ПланЛеченияВрачПИН,
	ВТ_Финал.НомерСтроки КАК НомерСтроки
ПОМЕСТИТЬ ВТ_Финал2
ИЗ
	ВТ_Финал КАК ВТ_Финал
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОплатаБаллами КАК ВТ_ОплатаБаллами
		ПО ВТ_Финал.Клиника = ВТ_ОплатаБаллами.Клиника
			И ВТ_Финал.Пациент = ВТ_ОплатаБаллами.Контрагент
			И ВТ_Финал.Регистратор = ВТ_ОплатаБаллами.Документ
			И ВТ_Финал.Услуга = ВТ_ОплатаБаллами.Номенклатура
ГДЕ
	(&Клиника = ЛОЖЬ
			ИЛИ ВТ_Финал.Клиника = &Клиника)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_Финал2.Регистратор КАК Регистратор,
	ВТ_Финал2.Регистратор.Менеджер КАК Менеджер,
	ВТ_Финал2.Пациент КАК Пациент,
	ВТ_Финал2.Клиника КАК Клиника,
	ВТ_Финал2.Отделение КАК Отделение,
	ВТ_Финал2.Услуга КАК Услуга,
	ВТ_Финал2.Услуга.Артикул КАК Артикул,
	ВТ_Финал2.СуммаОказаныхУслуг КАК СуммаОказаныхУслуг,
	ВТ_Финал2.СуммаСкидки КАК СуммаСкидки,
	ВТ_Финал2.КоличествоУслуг КАК КоличествоУслуг,
	ВТ_Финал2.НомерЗуба КАК НомерЗуба,
	ВЫБОР
		КОГДА ВТ_Финал2.Регистратор ССЫЛКА Документ.ПланЛечения
			ТОГДА ""
		ИНАЧЕ ВТ_Финал2.Сотрудник
	КОНЕЦ КАК Сотрудник,
	ВТ_Финал2.Период КАК Период,
	ВТ_Финал2.ПериодЧас КАК ПериодЧас,
	ВТ_Финал2.ПериодДень КАК ПериодДень,
	ВТ_Финал2.ПериодНеделя КАК ПериодНеделя,
	ВТ_Финал2.ПериодДекада КАК ПериодДекада,
	ВТ_Финал2.ПериодМесяц КАК ПериодМесяц,
	ВТ_Финал2.ПериодКвартал КАК ПериодКвартал,
	ВТ_Финал2.ПериодПолугодие КАК ПериодПолугодие,
	ВТ_Финал2.ПериодГод КАК ПериодГод,
	ВТ_Финал2.КоличествоПациентов КАК КоличествоПациентов,
	ВТ_Финал2.ПациентПервичный КАК ПациентПервичный,
	ВТ_Финал2.ПациентУсловноПеривычный6 КАК ПациентУсловноПеривычный6,
	ВТ_Финал2.ПациентУсловноПеривычный12 КАК ПациентУсловноПеривычный12,
	ВТ_ДопСведенияПоПериодамДействия.ИсточникИнформации КАК ИсточникИнформации,
	ВТ_Финал2.НаправленОт КАК НаправленОт,
	ВТ_Финал2.НаправленК КАК НаправленК,
	ВТ_Финал2.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
	ВТ_Финал2.МесяцевМеждуПриемами КАК МесяцевМеждуПриемами,
	ВТ_Финал2.МесяцевМеждуПриемамиУВрача КАК МесяцевМеждуПриемамиУВрача,
	ВТ_Финал2.СуммаОплат КАК СуммаОплат,
	ВТ_Финал2.СуммаОплатыДолга КАК СуммаОплатыДолга,
	ВТ_Финал2.СуммаПланаЛечения КАК СуммаПланаЛечения,
	ВТ_Финал2.Первичный КАК Первичный,
	ВЫРАЗИТЬ(ВТ_Финал2.Регистратор.Комментарий КАК СТРОКА(200)) КАК Комментарии,
	ВТ_ДопСведенияПоПериодамДействия.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВТ_ДопСведенияПоПериодамДействия.НомерКарты КАК НомерКарты,
	ВТ_ДопСведенияПоПериодамДействия.ТекущийМенеджер КАК ТекущийМенеджер,
	ВЫРАЗИТЬ(ВТ_ДопСведенияПоПериодамДействия.Комментарий КАК СТРОКА(200)) КАК КомментарийКлиники,
	ВТ_ДопСведенияПоПериодамДействия.Оператор КАК Оператор,
	ВТ_ДопСведенияПоПериодамДействия.УточнениеИсточникаИнформации КАК УточнениеИсточникаИнформации,
	ВТ_Финал2.СуммаВнесеноЗаПериод КАК СуммаВнесеноЗаПериод,
	ВТ_Финал2.СуммаОплатыБаллами КАК СуммаОплатыБаллами,
	ВТ_Финал2.ПланЛеченияВрачПИН КАК ПланЛеченияВрачПИН,
	ВТ_Финал2.НомерСтроки КАК НомерСтроки,
	ВТ_ДопСведенияПоПериодамДействия.ОператорКлиники КАК ОператорКлиники
ПОМЕСТИТЬ ВТ_Финал3
ИЗ
	ВТ_Финал2 КАК ВТ_Финал2
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ДопСведенияПоПериодамДействия КАК ВТ_ДопСведенияПоПериодамДействия
		ПО ВТ_Финал2.Пациент = ВТ_ДопСведенияПоПериодамДействия.Пациент
			И ВТ_Финал2.Клиника = ВТ_ДопСведенияПоПериодамДействия.Клиника
			И ВТ_Финал2.Период >= ВТ_ДопСведенияПоПериодамДействия.ДатаНачала
			И ВТ_Финал2.Период <= ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ПриходДенежныхСредствВидыОплат.Ссылка КАК Ссылка,
	ПриходДенежныхСредствВидыОплат.НомерСтроки КАК НомерСтроки,
	ПриходДенежныхСредствВидыОплат.Вид КАК Вид,
	ПриходДенежныхСредствВидыОплат.Сумма КАК Сумма,
	ПриходДенежныхСредствВидыОплат.Ссылка.Дата КАК Дата,
	&ДатаНачала КАК ДатаНачала,
	&ДатаОкончания КАК ДатаОкончания,
	ПриходДенежныхСредствВидыОплат.Ссылка.Контрагент КАК Контрагент,
	ПриходДенежныхСредствВидыОплат.Ссылка.Клиника КАК Клиника,
	ВТ_ДопСведенияПоПериодамДействия.ТекущийМенеджер КАК ТекущийМенеджер,
	ВТ_ДопСведенияПоПериодамДействия.ИсточникИнформации КАК ИсточникИнформации,
	ВТ_ДопСведенияПоПериодамДействия.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВТ_ДопСведенияПоПериодамДействия.НомерКарты КАК НомерКарты,
	ВТ_ДопСведенияПоПериодамДействия.Оператор КАК Оператор,
	ВТ_ДопСведенияПоПериодамДействия.УточнениеИсточникаИнформации КАК УточнениеИсточникаИнформации,
	ВТ_ДопСведенияПоПериодамДействия.НаправленК КАК НаправленК
ПОМЕСТИТЬ ВТ_ДС
ИЗ
	Документ.ПриходДенежныхСредств.ВидыОплат КАК ПриходДенежныхСредствВидыОплат
		ПОЛНОЕ СОЕДИНЕНИЕ ВТ_ДопСведенияПоПериодамДействия КАК ВТ_ДопСведенияПоПериодамДействия
		ПО ПриходДенежныхСредствВидыОплат.Ссылка.Контрагент = ВТ_ДопСведенияПоПериодамДействия.Пациент
			И ПриходДенежныхСредствВидыОплат.Ссылка.Клиника = ВТ_ДопСведенияПоПериодамДействия.Клиника
			И ПриходДенежныхСредствВидыОплат.Ссылка.Дата >= ВТ_ДопСведенияПоПериодамДействия.ДатаНачала
			И ПриходДенежныхСредствВидыОплат.Ссылка.Дата <= ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания
ГДЕ
	ПриходДенежныхСредствВидыОплат.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	И ПриходДенежныхСредствВидыОплат.Ссылка.Проведен
	И (ПриходДенежныхСредствВидыОплат.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Наличные)
			ИЛИ ПриходДенежныхСредствВидыОплат.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.БанковскаяКарта))

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПриходБезналичныхСредствВидыОплат.Ссылка,
	ПриходБезналичныхСредствВидыОплат.НомерСтроки,
	ПриходБезналичныхСредствВидыОплат.Вид,
	ПриходБезналичныхСредствВидыОплат.Сумма,
	ПриходБезналичныхСредствВидыОплат.Ссылка.Дата,
	&ДатаНачала,
	&ДатаОкончания,
	ПриходБезналичныхСредствВидыОплат.Ссылка.Контрагент,
	ПриходБезналичныхСредствВидыОплат.Ссылка.Клиника,
	ВТ_ДопСведенияПоПериодамДействия.ТекущийМенеджер,
	ВТ_ДопСведенияПоПериодамДействия.ИсточникИнформации,
	ВТ_ДопСведенияПоПериодамДействия.ПостфиксНомераКарты,
	ВТ_ДопСведенияПоПериодамДействия.НомерКарты,
	ВТ_ДопСведенияПоПериодамДействия.Оператор,
	ВТ_ДопСведенияПоПериодамДействия.УточнениеИсточникаИнформации,
	ВТ_ДопСведенияПоПериодамДействия.НаправленК
ИЗ
	Документ.ПриходБезналичныхСредств.ВидыОплат КАК ПриходБезналичныхСредствВидыОплат
		ПОЛНОЕ СОЕДИНЕНИЕ ВТ_ДопСведенияПоПериодамДействия КАК ВТ_ДопСведенияПоПериодамДействия
		ПО ПриходБезналичныхСредствВидыОплат.Ссылка.Контрагент = ВТ_ДопСведенияПоПериодамДействия.Пациент
			И ПриходБезналичныхСредствВидыОплат.Ссылка.Клиника = ВТ_ДопСведенияПоПериодамДействия.Клиника
			И ПриходБезналичныхСредствВидыОплат.Ссылка.Дата >= ВТ_ДопСведенияПоПериодамДействия.ДатаНачала
			И ПриходБезналичныхСредствВидыОплат.Ссылка.Дата <= ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания
ГДЕ
	ПриходБезналичныхСредствВидыОплат.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	И ПриходБезналичныхСредствВидыОплат.Ссылка.Проведен

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	РасходДенежныхСредствВидыОплат.Ссылка,
	РасходДенежныхСредствВидыОплат.НомерСтроки,
	РасходДенежныхСредствВидыОплат.Вид,
	-1 * РасходДенежныхСредствВидыОплат.Сумма,
	РасходДенежныхСредствВидыОплат.Ссылка.Дата,
	&ДатаНачала,
	&ДатаОкончания,
	РасходДенежныхСредствВидыОплат.Ссылка.Контрагент,
	РасходДенежныхСредствВидыОплат.Ссылка.Клиника,
	ВТ_ДопСведенияПоПериодамДействия.ТекущийМенеджер,
	ВТ_ДопСведенияПоПериодамДействия.ИсточникИнформации,
	ВТ_ДопСведенияПоПериодамДействия.ПостфиксНомераКарты,
	ВТ_ДопСведенияПоПериодамДействия.НомерКарты,
	ВТ_ДопСведенияПоПериодамДействия.Оператор,
	ВТ_ДопСведенияПоПериодамДействия.УточнениеИсточникаИнформации,
	ВТ_ДопСведенияПоПериодамДействия.НаправленК
ИЗ
	Документ.РасходДенежныхСредств.ВидыОплат КАК РасходДенежныхСредствВидыОплат
		ПОЛНОЕ СОЕДИНЕНИЕ ВТ_ДопСведенияПоПериодамДействия КАК ВТ_ДопСведенияПоПериодамДействия
		ПО РасходДенежныхСредствВидыОплат.Ссылка.Контрагент = ВТ_ДопСведенияПоПериодамДействия.Пациент
			И РасходДенежныхСредствВидыОплат.Ссылка.Клиника = ВТ_ДопСведенияПоПериодамДействия.Клиника
			И РасходДенежныхСредствВидыОплат.Ссылка.Дата >= ВТ_ДопСведенияПоПериодамДействия.ДатаНачала
			И РасходДенежныхСредствВидыОплат.Ссылка.Дата <= ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания
ГДЕ
	РасходДенежныхСредствВидыОплат.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	И РасходДенежныхСредствВидыОплат.Ссылка.Проведен
	И (РасходДенежныхСредствВидыОплат.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Наличные)
			ИЛИ РасходДенежныхСредствВидыОплат.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Безналичные)
			ИЛИ РасходДенежныхСредствВидыОплат.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.БанковскаяКарта))
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ЦеныНоменклатурыСрезПоследних.Клиника КАК Клиника,
	ЦеныНоменклатурыСрезПоследних.Номенклатура КАК Номенклатура,
	ЦеныНоменклатурыСрезПоследних.Цена КАК Цена,
	ЦеныНоменклатурыСрезПоследних.Период КАК Период,
	ЦеныНоменклатурыСрезПоследних.ВидЦены КАК ВидЦены
ПОМЕСТИТЬ ВТ_ЦеныНаНачало
ИЗ
	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
			ДОБАВИТЬКДАТЕ(&ДатаНачала, СЕКУНДА, 1),
			ВидЦены В (&ВидыЦен)
				И (Клиника, Номенклатура) В
					(ВЫБРАТЬ РАЗЛИЧНЫЕ
						ДанныеПродаж.Клиника КАК Клиника,
						ДанныеПродаж.Услуга КАК Услуга
					ИЗ
						ДанныеПродаж КАК ДанныеПродаж)) КАК ЦеныНоменклатурыСрезПоследних
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ЦеныНоменклатуры.Клиника КАК Клиника,
	ЦеныНоменклатуры.Номенклатура КАК Номенклатура,
	ЦеныНоменклатуры.Цена КАК Цена,
	ЦеныНоменклатуры.Период КАК Период,
	ЦеныНоменклатуры.ВидЦены КАК ВидЦены
ПОМЕСТИТЬ ВТ_ИзмененияЦенЗаПериод
ИЗ
	РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
ГДЕ
	ЦеныНоменклатуры.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
	И ЦеныНоменклатуры.ВидЦены В(&ВидыЦен)
	И (ЦеныНоменклатуры.Клиника, ЦеныНоменклатуры.Номенклатура) В
			(ВЫБРАТЬ РАЗЛИЧНЫЕ
				ДанныеПродаж.Клиника КАК Клиника,
				ДанныеПродаж.Услуга КАК Услуга
			ИЗ
				ДанныеПродаж КАК ДанныеПродаж)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ЦеныНаНачало.Клиника КАК Клиника,
	ВТ_ЦеныНаНачало.Номенклатура КАК Номенклатура,
	ВТ_ЦеныНаНачало.Цена КАК Цена,
	ВТ_ЦеныНаНачало.Период КАК Период,
	ВТ_ЦеныНаНачало.ВидЦены КАК ВидЦены
ПОМЕСТИТЬ ВТ_ЦеныНоменклатурВсеПериоды
ИЗ
	ВТ_ЦеныНаНачало КАК ВТ_ЦеныНаНачало

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ИзмененияЦенЗаПериод.Клиника,
	ВТ_ИзмененияЦенЗаПериод.Номенклатура,
	ВТ_ИзмененияЦенЗаПериод.Цена,
	ВТ_ИзмененияЦенЗаПериод.Период,
	ВТ_ИзмененияЦенЗаПериод.ВидЦены
ИЗ
	ВТ_ИзмененияЦенЗаПериод КАК ВТ_ИзмененияЦенЗаПериод
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ВТ_ЦеныНоменклатурВсеПериоды.Период КАК Период,
	ВТ_ЦеныНоменклатурВсеПериоды.Клиника КАК Клиника,
	ВТ_ЦеныНоменклатурВсеПериоды.Номенклатура КАК Номенклатура,
	ВТ_ЦеныНоменклатурВсеПериоды.ВидЦены КАК ВидЦены
ПОМЕСТИТЬ ВТ_ПериодыЦенНоменклатуры
ИЗ
	ВТ_ЦеныНоменклатурВсеПериоды КАК ВТ_ЦеныНоменклатурВсеПериоды
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	МИНИМУМ(ЕСТЬNULL(ДОБАВИТЬКДАТЕ(Правая.Период, СЕКУНДА, -1), ДАТАВРЕМЯ(2999, 12, 31, 23, 59, 59))) КАК ДатаОкончания,
	Левая.Клиника КАК Клиника,
	Левая.Номенклатура КАК Номенклатура,
	Левая.ВидЦены КАК ВидЦены,
	Левая.Период КАК ДатаНачала
ПОМЕСТИТЬ ВТ_ПериодыДействияЦен
ИЗ
	ВТ_ПериодыЦенНоменклатуры КАК Левая
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПериодыЦенНоменклатуры КАК Правая
		ПО Левая.Клиника = Правая.Клиника
			И Левая.Номенклатура = Правая.Номенклатура
			И Левая.ВидЦены = Правая.ВидЦены
			И Левая.Период < Правая.Период

СГРУППИРОВАТЬ ПО
	Левая.Клиника,
	Левая.Номенклатура,
	Левая.ВидЦены,
	Левая.Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ПериодыДействияЦен.ДатаОкончания КАК ДатаОкончанияЦен,
	ВТ_ПериодыДействияЦен.Клиника КАК Клиника,
	ВТ_ПериодыДействияЦен.Номенклатура КАК Номенклатура,
	ВТ_ПериодыДействияЦен.ВидЦены КАК ВидЦены,
	ВТ_ПериодыДействияЦен.ДатаНачала КАК ДатаНачалаЦен,
	ВТ_ЦеныНоменклатурВсеПериоды.Цена КАК Цена,
	ВЫБОР
		КОГДА ВТ_ПериодыДействияЦен.ВидЦены = ЗНАЧЕНИЕ(Справочник.ВидыЦен.ПлановаяСебестоимость)
			ТОГДА ВТ_ЦеныНоменклатурВсеПериоды.Цена
		ИНАЧЕ 0
	КОНЕЦ КАК ЦенаПлановая,
	ВЫБОР
		КОГДА ВТ_ПериодыДействияЦен.ВидЦены = ЗНАЧЕНИЕ(Справочник.ВидыЦен.АгентскаяСебестоимость)
			ТОГДА ВТ_ЦеныНоменклатурВсеПериоды.Цена
		ИНАЧЕ 0
	КОНЕЦ КАК ЦенаАгентская
ПОМЕСТИТЬ ВТ_ЦеныПоПериодамДействия
ИЗ
	ВТ_ПериодыДействияЦен КАК ВТ_ПериодыДействияЦен
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЦеныНоменклатурВсеПериоды КАК ВТ_ЦеныНоменклатурВсеПериоды
		ПО ВТ_ПериодыДействияЦен.Клиника = ВТ_ЦеныНоменклатурВсеПериоды.Клиника
			И ВТ_ПериодыДействияЦен.Номенклатура = ВТ_ЦеныНоменклатурВсеПериоды.Номенклатура
			И ВТ_ПериодыДействияЦен.ВидЦены = ВТ_ЦеныНоменклатурВсеПериоды.ВидЦены
			И ВТ_ПериодыДействияЦен.ДатаНачала = ВТ_ЦеныНоменклатурВсеПериоды.Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ЦеныПоПериодамДействия.ДатаОкончанияЦен КАК ДатаОкончанияЦен,
	ВТ_ЦеныПоПериодамДействия.Клиника КАК Клиника,
	ВТ_ЦеныПоПериодамДействия.Номенклатура КАК Номенклатура,
	ВТ_ЦеныПоПериодамДействия.ВидЦены КАК ВидЦены,
	ВТ_ЦеныПоПериодамДействия.ДатаНачалаЦен КАК ДатаНачалаЦен,
	ВТ_ЦеныПоПериодамДействия.ЦенаПлановая КАК ЦенаПлановая
ПОМЕСТИТЬ ВТ_ПлановыеЦеныПоПериодам
ИЗ
	ВТ_ЦеныПоПериодамДействия КАК ВТ_ЦеныПоПериодамДействия
ГДЕ
	ВТ_ЦеныПоПериодамДействия.ВидЦены = ЗНАЧЕНИЕ(Справочник.ВидыЦен.ПлановаяСебестоимость)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ЦеныПоПериодамДействия.ДатаОкончанияЦен КАК ДатаОкончанияЦен,
	ВТ_ЦеныПоПериодамДействия.Клиника КАК Клиника,
	ВТ_ЦеныПоПериодамДействия.Номенклатура КАК Номенклатура,
	ВТ_ЦеныПоПериодамДействия.ВидЦены КАК ВидЦены,
	ВТ_ЦеныПоПериодамДействия.ДатаНачалаЦен КАК ДатаНачалаЦен,
	ВТ_ЦеныПоПериодамДействия.ЦенаАгентская КАК ЦенаАгентская
ПОМЕСТИТЬ ВТ_АгентскиеЦеныПоПериодам
ИЗ
	ВТ_ЦеныПоПериодамДействия КАК ВТ_ЦеныПоПериодамДействия
ГДЕ
	ВТ_ЦеныПоПериодамДействия.ВидЦены = ЗНАЧЕНИЕ(Справочник.ВидыЦен.АгентскаяСебестоимость)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	ВТ_Финал3.Регистратор КАК Регистратор,
	ВТ_Финал3.Менеджер КАК Менеджер,
	ВТ_Финал3.Пациент КАК Пациент,
	ВТ_Финал3.Клиника КАК Клиника,
	ВТ_Финал3.Отделение КАК Отделение,
	ВТ_Финал3.Услуга КАК Услуга,
	ВТ_Финал3.Артикул КАК Артикул,
	ВТ_Финал3.СуммаОказаныхУслуг КАК СуммаОказаныхУслуг,
	ВТ_Финал3.СуммаСкидки КАК СуммаСкидки,
	ВТ_Финал3.КоличествоУслуг КАК КоличествоУслуг,
	ВТ_Финал3.НомерЗуба КАК НомерЗуба,
	ВТ_Финал3.Сотрудник КАК Сотрудник,
	ВТ_Финал3.Период КАК Период,
	ВТ_Финал3.ПериодЧас КАК ПериодЧас,
	ВТ_Финал3.ПериодДень КАК ПериодДень,
	ВТ_Финал3.ПериодНеделя КАК ПериодНеделя,
	ВТ_Финал3.ПериодДекада КАК ПериодДекада,
	ВТ_Финал3.ПериодМесяц КАК ПериодМесяц,
	ВТ_Финал3.ПериодКвартал КАК ПериодКвартал,
	ВТ_Финал3.ПериодПолугодие КАК ПериодПолугодие,
	ВТ_Финал3.ПериодГод КАК ПериодГод,
	ВТ_Финал3.КоличествоПациентов КАК КоличествоПациентов,
	ВТ_Финал3.ПациентПервичный КАК ПациентПервичный,
	ВТ_Финал3.ПациентУсловноПеривычный6 КАК ПациентУсловноПеривычный6,
	ВТ_Финал3.ПациентУсловноПеривычный12 КАК ПациентУсловноПеривычный12,
	ЕСТЬNULL(ВТ_Финал3.ИсточникИнформации, ЗНАЧЕНИЕ(Справочник.ИсточникиРекламы.ПустаяСсылка)) КАК ИсточникИнформации,
	ВТ_Финал3.НаправленОт КАК НаправленОт,
	ВТ_Финал3.НаправленК КАК НаправленК,
	ВТ_Финал3.КомментарийИсточникаИнформации КАК КомментарийИсточникаИнформации,
	ВТ_Финал3.МесяцевМеждуПриемами КАК МесяцевМеждуПриемами,
	ВТ_Финал3.МесяцевМеждуПриемамиУВрача КАК МесяцевМеждуПриемамиУВрача,
	ВТ_Финал3.СуммаОплат КАК СуммаОплат,
	ВТ_Финал3.СуммаОплатыДолга КАК СуммаОплатыДолга,
	ВТ_Финал3.СуммаПланаЛечения КАК СуммаПланаЛечения,
	ВТ_Финал3.Первичный КАК Первичный,
	ВТ_Финал3.Комментарии КАК Комментарии,
	ВТ_Финал3.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВТ_Финал3.НомерКарты КАК НомерКарты,
	ВТ_Финал3.ТекущийМенеджер КАК ТекущийМенеджер,
	ВТ_Финал3.КомментарийКлиники КАК КомментарийКлиники,
	0 КАК Наличные,
	0 КАК Карта,
	0 КАК Безналичные,
	ВТ_Финал3.ТекущийМенеджер.ПИН КАК ТекущийМенеджерПИН,
	ВТ_Финал3.Оператор.ПИН КАК ОператорПИН,
	ВТ_Финал3.УточнениеИсточникаИнформации КАК УточнениеИсточникаИнформации,
	ВТ_Финал3.СуммаВнесеноЗаПериод КАК СуммаВнесеноЗаПериод,
	ВТ_ПлановыеЦеныПоПериодам.ЦенаПлановая КАК ЦенаПлановая,
	ВТ_АгентскиеЦеныПоПериодам.ЦенаАгентская КАК ЦенаАгентская,
	ВТ_Финал3.КоличествоУслуг * ВТ_ПлановыеЦеныПоПериодам.ЦенаПлановая КАК ССПлановая,
	ВТ_Финал3.КоличествоУслуг * ВТ_АгентскиеЦеныПоПериодам.ЦенаАгентская КАК ССАгентская,
	ВТ_Финал3.СуммаОплатыБаллами КАК СуммаОплатыБаллами,
	ВТ_Финал3.ПланЛеченияВрачПИН КАК ПланЛеченияВрачПИН,
	ВТ_Финал3.Оператор КАК ОператорДляСвязи,
	ВТ_Финал3.НомерСтроки КАК НомерСтроки,
	ВТ_Финал3.ОператорКлиники КАК ОператорКлиники
ПОМЕСТИТЬ ВТ_ДляСвязиСДопСведениями
ИЗ
	ВТ_Финал3 КАК ВТ_Финал3
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПлановыеЦеныПоПериодам КАК ВТ_ПлановыеЦеныПоПериодам
		ПО ВТ_Финал3.Клиника = ВТ_ПлановыеЦеныПоПериодам.Клиника
			И ВТ_Финал3.Услуга = ВТ_ПлановыеЦеныПоПериодам.Номенклатура
			И ВТ_Финал3.Период >= ВТ_ПлановыеЦеныПоПериодам.ДатаНачалаЦен
			И ВТ_Финал3.Период <= ВТ_ПлановыеЦеныПоПериодам.ДатаОкончанияЦен
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_АгентскиеЦеныПоПериодам КАК ВТ_АгентскиеЦеныПоПериодам
		ПО ВТ_Финал3.Клиника = ВТ_АгентскиеЦеныПоПериодам.Клиника
			И ВТ_Финал3.Услуга = ВТ_АгентскиеЦеныПоПериодам.Номенклатура
			И ВТ_Финал3.Период >= ВТ_АгентскиеЦеныПоПериодам.ДатаНачалаЦен
			И ВТ_Финал3.Период <= ВТ_АгентскиеЦеныПоПериодам.ДатаОкончанияЦен
ГДЕ
	(&Клиника = ЛОЖЬ
			ИЛИ ВТ_Финал3.Клиника = &Клиника)

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВТ_ДС.Ссылка,
	NULL,
	ВТ_ДС.Контрагент,
	ВТ_ДС.Клиника,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	ВТ_ДС.Дата,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	ЕСТЬNULL(ВТ_ДС.ИсточникИнформации, ЗНАЧЕНИЕ(Справочник.ИсточникиРекламы.ПустаяСсылка)),
	NULL,
	ВТ_ДС.НаправленК,
	NULL,
	NULL,
	NULL,
	ВТ_ДС.Сумма,
	NULL,
	NULL,
	NULL,
	NULL,
	ВТ_ДС.ПостфиксНомераКарты,
	ВТ_ДС.НомерКарты,
	ВТ_ДС.ТекущийМенеджер,
	NULL,
	ВЫБОР
		КОГДА ВТ_ДС.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Наличные)
			ТОГДА ВТ_ДС.Сумма
		ИНАЧЕ 0
	КОНЕЦ,
	ВЫБОР
		КОГДА ВТ_ДС.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.БанковскаяКарта)
			ТОГДА ВТ_ДС.Сумма
		ИНАЧЕ 0
	КОНЕЦ,
	ВЫБОР
		КОГДА ВТ_ДС.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Безналичные)
			ТОГДА ВТ_ДС.Сумма
		ИНАЧЕ 0
	КОНЕЦ,
	ВТ_ДС.ТекущийМенеджер.ПИН,
	ВТ_ДС.Оператор.ПИН,
	ВТ_ДС.УточнениеИсточникаИнформации,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	ВТ_ДС.Оператор,
	NULL,
	NULL
ИЗ
	ВТ_ДС КАК ВТ_ДС
ГДЕ
	(&Клиника = ЛОЖЬ
			ИЛИ ВТ_ДС.Клиника = &Клиника)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ГрафикиРаботыСотрудников.Сотрудник КАК Сотрудник,
	СУММА(1) КАК КоличествоСмен
ПОМЕСТИТЬ ВТ_ГрафикРаботы
ИЗ
	РегистрСведений.ГрафикиРаботыСотрудников КАК ГрафикиРаботыСотрудников
ГДЕ
	ГрафикиРаботыСотрудников.Дата МЕЖДУ НАЧАЛОПЕРИОДА(&ДатаНачалаАванса, ДЕНЬ) И КОНЕЦПЕРИОДА(&ДатаККонецЗадолжность, ДЕНЬ)
	И ГрафикиРаботыСотрудников.ТипВремени = ЗНАЧЕНИЕ(Справочник.ВидыРабочегоВремени.Рабочее)

СГРУППИРОВАТЬ ПО
	ГрафикиРаботыСотрудников.Сотрудник
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ДляСвязиСДопСведениями.Регистратор КАК Регистратор,
	ВТ_ДляСвязиСДопСведениями.Менеджер КАК Менеджер,
	ВТ_ДляСвязиСДопСведениями.Пациент КАК Пациент,
	ВТ_ДляСвязиСДопСведениями.Клиника КАК Клиника,
	ВТ_ДляСвязиСДопСведениями.Отделение КАК Отделение,
	ВТ_ДляСвязиСДопСведениями.Услуга КАК Услуга,
	ВТ_ДляСвязиСДопСведениями.Артикул КАК Артикул,
	ВТ_ДляСвязиСДопСведениями.СуммаОказаныхУслуг КАК СуммаОказаныхУслуг,
	ВТ_ДляСвязиСДопСведениями.СуммаСкидки КАК СуммаСкидки,
	ВТ_ДляСвязиСДопСведениями.КоличествоУслуг КАК КоличествоУслуг,
	ВТ_ДляСвязиСДопСведениями.НомерЗуба КАК НомерЗуба,
	ВТ_ДляСвязиСДопСведениями.Сотрудник КАК Сотрудник,
	ВТ_ДляСвязиСДопСведениями.Период КАК Период,
	ВТ_ДляСвязиСДопСведениями.ПериодЧас КАК ПериодЧас,
	ВТ_ДляСвязиСДопСведениями.ПериодДень КАК ПериодДень,
	ВТ_ДляСвязиСДопСведениями.ПериодНеделя КАК ПериодНеделя,
	ВТ_ДляСвязиСДопСведениями.ПериодДекада КАК ПериодДекада,
	ВТ_ДляСвязиСДопСведениями.ПериодМесяц КАК ПериодМесяц,
	ВТ_ДляСвязиСДопСведениями.ПериодКвартал КАК ПериодКвартал,
	ВТ_ДляСвязиСДопСведениями.ПериодПолугодие КАК ПериодПолугодие,
	ВТ_ДляСвязиСДопСведениями.ПериодГод КАК ПериодГод,
	ВТ_ДляСвязиСДопСведениями.КоличествоПациентов КАК КоличествоПациентов,
	ВТ_ДляСвязиСДопСведениями.ПациентПервичный КАК ПациентПервичный,
	ВТ_ДляСвязиСДопСведениями.ПациентУсловноПеривычный6 КАК ПациентУсловноПеривычный6,
	ВТ_ДляСвязиСДопСведениями.ПациентУсловноПеривычный12 КАК ПациентУсловноПеривычный12,
	ВТ_ДляСвязиСДопСведениями.МесяцевМеждуПриемами КАК МесяцевМеждуПриемами,
	ВТ_ДляСвязиСДопСведениями.МесяцевМеждуПриемамиУВрача КАК МесяцевМеждуПриемамиУВрача,
	ВТ_ДляСвязиСДопСведениями.СуммаОплат КАК СуммаОплат,
	ВТ_ДляСвязиСДопСведениями.СуммаОплатыДолга КАК СуммаОплатыДолга,
	ВТ_ДляСвязиСДопСведениями.СуммаПланаЛечения КАК СуммаПланаЛечения,
	ВТ_ДляСвязиСДопСведениями.Первичный КАК Первичный,
	ВТ_ДляСвязиСДопСведениями.Наличные КАК Наличные,
	ВТ_ДляСвязиСДопСведениями.Карта КАК Карта,
	ВТ_ДляСвязиСДопСведениями.Безналичные КАК Безналичные,
	ВТ_ДляСвязиСДопСведениями.ТекущийМенеджерПИН КАК ТекущийМенеджерПИН,
	ВТ_ДляСвязиСДопСведениями.ОператорПИН КАК ОператорПИН,
	ВТ_ДляСвязиСДопСведениями.СуммаВнесеноЗаПериод КАК СуммаВнесеноЗаПериод,
	ВТ_ДляСвязиСДопСведениями.ЦенаПлановая КАК ЦенаПлановая,
	ВТ_ДляСвязиСДопСведениями.ЦенаАгентская КАК ЦенаАгентская,
	ВТ_ДляСвязиСДопСведениями.ССПлановая КАК ССПлановая,
	ВТ_ДляСвязиСДопСведениями.ССАгентская КАК ССАгентская,
	ВТ_ДляСвязиСДопСведениями.СуммаОплатыБаллами КАК СуммаОплатыБаллами,
	ВТ_ДляСвязиСДопСведениями.ПланЛеченияВрачПИН КАК ПланЛеченияВрачПИН,
	ВТ_ДопСведенияПоПериодамДействия.НомерКарты КАК НомерКарты,
	ВТ_ДопСведенияПоПериодамДействия.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВТ_ДопСведенияПоПериодамДействия.ДатаКарты КАК ДатаКарты,
	ВТ_ДопСведенияПоПериодамДействия.НомерДоговора КАК НомерДоговора,
	ВТ_ДопСведенияПоПериодамДействия.ДатаДоговора КАК ДатаДоговора,
	ВТ_ДопСведенияПоПериодамДействия.Ответственный КАК Ответственный,
	ВТ_ДопСведенияПоПериодамДействия.ТекущийМенеджер КАК ТекущийМенеджер,
	ВТ_ДопСведенияПоПериодамДействия.МестонахождениеКарты КАК МестонахождениеКарты,
	ВТ_ДопСведенияПоПериодамДействия.КатегорияКонтрагента КАК КатегорияКонтрагента,
	ЕСТЬNULL(ВТ_ДопСведенияПоПериодамДействия.ИсточникИнформации, ЗНАЧЕНИЕ(Справочник.ИсточникиРекламы.ПустаяСсылка)) КАК ИсточникИнформации,
	ВТ_ДопСведенияПоПериодамДействия.НаправленОт КАК НаправленОт,
	ВТ_ДопСведенияПоПериодамДействия.ЗаписьНаПриемЗапрещена КАК ЗаписьНаПриемЗапрещена,
	ВТ_ДопСведенияПоПериодамДействия.НапоминатьОДнеРождения КАК НапоминатьОДнеРождения,
	ВТ_ДопСведенияПоПериодамДействия.ЗапретЗвонков КАК ЗапретЗвонков,
	ВТ_ДопСведенияПоПериодамДействия.ЗапретEMailРассылки КАК ЗапретEMailРассылки,
	ВТ_ДопСведенияПоПериодамДействия.ЗапретSMSРассылки КАК ЗапретSMSРассылки,
	ЕСТЬNULL(ВТ_ДопСведенияПоПериодамДействия.НаправленК, ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка)) КАК НаправленК,
	ВТ_ДопСведенияПоПериодамДействия.Оператор КАК Оператор,
	ЕСТЬNULL(ВТ_ДопСведенияПоПериодамДействия.УточнениеИсточникаИнформации, ЗНАЧЕНИЕ(Справочник.УточненияИсточниковИнформации.ПустаяСсылка)) КАК УточнениеИсточникаИнформации,
	ВТ_ДопСведенияПоПериодамДействия.ИсточникИнформации КАК ИсточникИнформацииОтбор,
	ВЫБОР
		КОГДА ВТ_ДляСвязиСДопСведениями.Регистратор ССЫЛКА Документ.ПриемВрача
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПриемВрача,
	ВТ_Проекты.ПроектКЦ КАК ПроектКЦ,
	ВТ_ДопСведенияПоПериодамДействия.ДатаНачала КАК ДатаНачалаДопСведений,
	ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания КАК ДатаОкончанияДопСведений,
	ВТ_Аванс.Аванс КАК Аванс,
	ВТ_Задолжность.Задолженность КАК Задолженность,
	ВТ_Задолжность.Аванс КАК АвансЗадолжность,
	ВТ_Задолжность.Задолженность КАК Остаток,
	ВТ_ГрафикРаботы.КоличествоСмен КАК КоличествоСмен,
	ВЫБОР
		КОГДА ВТ_ПациентыСОплатойБольшеПорога.Сумма ЕСТЬ NULL
			ТОГДА NULL
		ИНАЧЕ ВТ_КлиникиПациентыПриемы.Пациент
	КОНЕЦ КАК ОплатаБольшеРавнаПорогу,
	ВТ_ДляСвязиСДопСведениями.НомерСтроки КАК НомерСтроки,
	ВТ_ДляСвязиСДопСведениями.ОператорКлиники КАК ОператорКлиники
ПОМЕСТИТЬ ВТ_ОбщаяТаблица
ИЗ
	ВТ_ДляСвязиСДопСведениями КАК ВТ_ДляСвязиСДопСведениями
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ДопСведенияПоПериодамДействия КАК ВТ_ДопСведенияПоПериодамДействия
			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_КлиникиПациентыПриемы КАК ВТ_КлиникиПациентыПриемы
				ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПациентыСОплатойБольшеПорога КАК ВТ_ПациентыСОплатойБольшеПорога
				ПО ВТ_КлиникиПациентыПриемы.Клиника = ВТ_ПациентыСОплатойБольшеПорога.Клиника
					И ВТ_КлиникиПациентыПриемы.Пациент = ВТ_ПациентыСОплатойБольшеПорога.Контрагент
			ПО (ВТ_КлиникиПациентыПриемы.Клиника = ВТ_ДопСведенияПоПериодамДействия.Клиника)
				И (ВТ_КлиникиПациентыПриемы.Период >= ВТ_ДопСведенияПоПериодамДействия.ДатаНачала)
				И (ВТ_КлиникиПациентыПриемы.Период <= ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания)
				И (ВТ_КлиникиПациентыПриемы.Пациент = ВТ_ДопСведенияПоПериодамДействия.Пациент)
		ПО ВТ_ДляСвязиСДопСведениями.Клиника = ВТ_ДопСведенияПоПериодамДействия.Клиника
			И ВТ_ДляСвязиСДопСведениями.Пациент = ВТ_ДопСведенияПоПериодамДействия.Пациент
			И ВТ_ДляСвязиСДопСведениями.Период >= ВТ_ДопСведенияПоПериодамДействия.ДатаНачала
			И ВТ_ДляСвязиСДопСведениями.Период <= ВТ_ДопСведенияПоПериодамДействия.ДатаОкончания
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Проекты КАК ВТ_Проекты
		ПО ВТ_ДляСвязиСДопСведениями.ОператорДляСвязи = ВТ_Проекты.Участник
			И ВТ_ДляСвязиСДопСведениями.Период >= ВТ_Проекты.ДатаНачала
			И ВТ_ДляСвязиСДопСведениями.Период <= ВТ_Проекты.ДатаОкончания
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Аванс КАК ВТ_Аванс
		ПО ВТ_ДляСвязиСДопСведениями.Клиника = ВТ_Аванс.Клиника
			И ВТ_ДляСвязиСДопСведениями.Пациент = ВТ_Аванс.Пациент
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Задолжность КАК ВТ_Задолжность
		ПО ВТ_ДляСвязиСДопСведениями.Клиника = ВТ_Задолжность.Клиника
			И ВТ_ДляСвязиСДопСведениями.Пациент = ВТ_Задолжность.Пациент
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ГрафикРаботы КАК ВТ_ГрафикРаботы
		ПО ВТ_ДляСвязиСДопСведениями.ТекущийМенеджер = ВТ_ГрафикРаботы.Сотрудник
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ИсточникиРекламы.Ссылка КАК Ссылка
ПОМЕСТИТЬ ВТ_ИсточникиКЦ
ИЗ
	Справочник.ИсточникиРекламы КАК ИсточникиРекламы
ГДЕ
	ИсточникиРекламы.Наименование ПОДОБНО "%Call%"
	И ИсточникиРекламы.ПометкаУдаления = ЛОЖЬ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	УточненияИсточниковИнформации.Ссылка КАК Ссылка
ПОМЕСТИТЬ ВТ_УточнениеСрок
ИЗ
	Справочник.УточненияИсточниковИнформации КАК УточненияИсточниковИнформации
ГДЕ
	УточненияИсточниковИнформации.ПометкаУдаления = ЛОЖЬ
	И УточненияИсточниковИнформации.СчитатьБазойКлиники
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	Теги.Ссылка КАК Ссылка,
	Теги.Наименование КАК Наименование,
	СоответствиеКлиникИТегов.Клиника КАК Клиника
ПОМЕСТИТЬ ВТ_Теги
ИЗ
	РегистрСведений.СоответствиеКлиникИТегов КАК СоответствиеКлиникИТегов
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Теги КАК Теги
		ПО СоответствиеКлиникИТегов.Тег = Теги.Ссылка
ГДЕ
	Теги.Наименование ПОДОБНО "%Отзыв%"
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВТ_ОбщаяТаблица.Регистратор КАК Регистратор,
	ВТ_ОбщаяТаблица.Менеджер КАК Менеджер,
	ВТ_ОбщаяТаблица.Пациент КАК Пациент,
	ВТ_ОбщаяТаблица.Клиника КАК Клиника,
	ВТ_ОбщаяТаблица.Отделение КАК Отделение,
	ВТ_ОбщаяТаблица.Услуга КАК Услуга,
	ВТ_ОбщаяТаблица.Артикул КАК Артикул,
	ВТ_ОбщаяТаблица.СуммаОказаныхУслуг КАК СуммаОказаныхУслуг,
	ВТ_ОбщаяТаблица.СуммаСкидки КАК СуммаСкидки,
	ВТ_ОбщаяТаблица.КоличествоУслуг КАК КоличествоУслуг,
	ВТ_ОбщаяТаблица.НомерЗуба КАК НомерЗуба,
	ВТ_ОбщаяТаблица.Сотрудник КАК Сотрудник,
	ВТ_ОбщаяТаблица.Период КАК Период,
	ВТ_ОбщаяТаблица.ПериодЧас КАК ПериодЧас,
	ВТ_ОбщаяТаблица.ПериодДень КАК ПериодДень,
	ВТ_ОбщаяТаблица.ПериодНеделя КАК ПериодНеделя,
	ВТ_ОбщаяТаблица.ПериодДекада КАК ПериодДекада,
	ВТ_ОбщаяТаблица.ПериодМесяц КАК ПериодМесяц,
	ВТ_ОбщаяТаблица.ПериодКвартал КАК ПериодКвартал,
	ВТ_ОбщаяТаблица.ПериодПолугодие КАК ПериодПолугодие,
	ВТ_ОбщаяТаблица.ПериодГод КАК ПериодГод,
	ВТ_ОбщаяТаблица.КоличествоПациентов КАК КоличествоПациентов,
	ВТ_ОбщаяТаблица.ПациентПервичный КАК ПациентПервичный,
	ВТ_ОбщаяТаблица.ПациентУсловноПеривычный6 КАК ПациентУсловноПеривычный6,
	ВТ_ОбщаяТаблица.ПациентУсловноПеривычный12 КАК ПациентУсловноПеривычный12,
	ВТ_ОбщаяТаблица.МесяцевМеждуПриемами КАК МесяцевМеждуПриемами,
	ВТ_ОбщаяТаблица.МесяцевМеждуПриемамиУВрача КАК МесяцевМеждуПриемамиУВрача,
	ВТ_ОбщаяТаблица.СуммаОплат КАК СуммаОплат,
	ВТ_ОбщаяТаблица.СуммаОплатыДолга КАК СуммаОплатыДолга,
	ВТ_ОбщаяТаблица.СуммаПланаЛечения КАК СуммаПланаЛечения,
	ВТ_ОбщаяТаблица.Первичный КАК Первичный,
	ВТ_ОбщаяТаблица.Наличные КАК Наличные,
	ВТ_ОбщаяТаблица.Карта КАК Карта,
	ВТ_ОбщаяТаблица.Безналичные КАК Безналичные,
	ВТ_ОбщаяТаблица.ТекущийМенеджерПИН КАК ТекущийМенеджерПИН,
	ВТ_ОбщаяТаблица.ОператорПИН КАК ОператорПИН,
	ВТ_ОбщаяТаблица.СуммаВнесеноЗаПериод КАК СуммаВнесеноЗаПериод,
	ВТ_ОбщаяТаблица.ЦенаПлановая КАК ЦенаПлановая,
	ВТ_ОбщаяТаблица.ЦенаАгентская КАК ЦенаАгентская,
	ВТ_ОбщаяТаблица.ССПлановая КАК ССПлановая,
	ВТ_ОбщаяТаблица.ССАгентская КАК ССАгентская,
	ВТ_ОбщаяТаблица.СуммаОплатыБаллами КАК СуммаОплатыБаллами,
	ВТ_ОбщаяТаблица.ПланЛеченияВрачПИН КАК ПланЛеченияВрачПИН,
	ВТ_ОбщаяТаблица.НомерКарты КАК НомерКарты,
	ВТ_ОбщаяТаблица.ПостфиксНомераКарты КАК ПостфиксНомераКарты,
	ВТ_ОбщаяТаблица.ДатаКарты КАК ДатаКарты,
	ВТ_ОбщаяТаблица.НомерДоговора КАК НомерДоговора,
	ВТ_ОбщаяТаблица.ДатаДоговора КАК ДатаДоговора,
	ВТ_ОбщаяТаблица.Ответственный КАК Ответственный,
	ВТ_ОбщаяТаблица.ТекущийМенеджер КАК ТекущийМенеджер,
	ВТ_ОбщаяТаблица.МестонахождениеКарты КАК МестонахождениеКарты,
	ВТ_ОбщаяТаблица.КатегорияКонтрагента КАК КатегорияКонтрагента,
	ВТ_ОбщаяТаблица.ИсточникИнформации КАК ИсточникИнформации,
	ВТ_ОбщаяТаблица.НаправленОт КАК НаправленОт,
	ВТ_ОбщаяТаблица.ЗаписьНаПриемЗапрещена КАК ЗаписьНаПриемЗапрещена,
	ВТ_ОбщаяТаблица.НапоминатьОДнеРождения КАК НапоминатьОДнеРождения,
	ВТ_ОбщаяТаблица.ЗапретЗвонков КАК ЗапретЗвонков,
	ВТ_ОбщаяТаблица.ЗапретEMailРассылки КАК ЗапретEMailРассылки,
	ВТ_ОбщаяТаблица.ЗапретSMSРассылки КАК ЗапретSMSРассылки,
	ВТ_ОбщаяТаблица.НаправленК КАК НаправленК,
	ВТ_ОбщаяТаблица.Оператор КАК Оператор,
	ВТ_ОбщаяТаблица.УточнениеИсточникаИнформации КАК УточнениеИсточникаИнформации,
	ВТ_ОбщаяТаблица.ИсточникИнформацииОтбор КАК ИсточникИнформацииОтбор,
	ВТ_ОбщаяТаблица.ЭтоПриемВрача КАК ЭтоПриемВрача,
	ВТ_ОбщаяТаблица.ПроектКЦ КАК ПроектКЦ,
	ВТ_ОбщаяТаблица.ДатаНачалаДопСведений КАК ДатаНачалаДопСведений,
	ВТ_ОбщаяТаблица.ДатаОкончанияДопСведений КАК ДатаОкончанияДопСведений,
	ВТ_ОбщаяТаблица.Аванс КАК Аванс,
	ВТ_ОбщаяТаблица.Задолженность КАК Задолженность,
	ВТ_ОбщаяТаблица.АвансЗадолжность КАК АвансЗадолжность,
	ВТ_ОбщаяТаблица.Остаток КАК Остаток,
	ВТ_ОбщаяТаблица.КоличествоСмен КАК КоличествоСмен,
	ВТ_ОбщаяТаблица.ОплатаБольшеРавнаПорогу КАК ОплатаБольшеРавнаПорогу,
	ВТ_ОбщаяТаблица.НомерСтроки КАК НомерСтроки,
	0 КАК ПИ3,
	ВЫБОР
		КОГДА ВТ_ОбщаяТаблица.ИсточникИнформацииОтбор В
				(ВЫБРАТЬ
					ВТ_ИсточникиКЦ.Ссылка
				ИЗ
					ВТ_ИсточникиКЦ КАК ВТ_ИсточникиКЦ)
			ТОГДА ВТ_ОбщаяТаблица.СуммаОплат + ВТ_ОбщаяТаблица.СуммаОплатыДолга - ЕСТЬNULL(ВТ_ОбщаяТаблица.СуммаОплатыБаллами, 0)
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаДСКЦ,
	ВЫБОР
		КОГДА НЕ ВТ_ОбщаяТаблица.ИсточникИнформацииОтбор В
					(ВЫБРАТЬ
						ВТ_ИсточникиКЦ.Ссылка
					ИЗ
						ВТ_ИсточникиКЦ КАК ВТ_ИсточникиКЦ)
			ТОГДА ВТ_ОбщаяТаблица.СуммаОплат + ВТ_ОбщаяТаблица.СуммаОплатыДолга - ЕСТЬNULL(ВТ_ОбщаяТаблица.СуммаОплатыБаллами, 0)
		ИНАЧЕ 0
	КОНЕЦ КАК СобственныеИсточники,
	ВЫБОР
		КОГДА ВТ_ОбщаяТаблица.УточнениеИсточникаИнформации В
				(ВЫБРАТЬ
					ВТ_УточнениеСрок.Ссылка
				ИЗ
					ВТ_УточнениеСрок КАК ВТ_УточнениеСрок)
			ТОГДА ВТ_ОбщаяТаблица.СуммаОплат + ВТ_ОбщаяТаблица.СуммаОплатыДолга - ЕСТЬNULL(ВТ_ОбщаяТаблица.СуммаОплатыБаллами, 0)
		ИНАЧЕ 0
	КОНЕЦ КАК БазаСправочно,
	ВЫБОР
		КОГДА ВТ_ОбщаяТаблица.УточнениеИсточникаИнформации В
				(ВЫБРАТЬ
					ВТ_УточнениеСрок.Ссылка
				ИЗ
					ВТ_УточнениеСрок КАК ВТ_УточнениеСрок)
			ТОГДА ВТ_ОбщаяТаблица.СуммаВнесеноЗаПериод
		ИНАЧЕ 0
	КОНЕЦ КАК ВнесеноДСПоБазе,
	ВЫБОР
		КОГДА ВТ_ОбщаяТаблица.ИсточникИнформации = ЗНАЧЕНИЕ(Справочник.ИсточникиРекламы.НаправленОт)
			ТОГДА ВТ_ОбщаяТаблица.СуммаОплат + ВТ_ОбщаяТаблица.СуммаОплатыДолга - ЕСТЬNULL(ВТ_ОбщаяТаблица.СуммаОплатыБаллами, 0)
		ИНАЧЕ 0
	КОНЕЦ КАК ОтработаноПоРекомендацииМенеджераСправочно,
	ВЫБОР
		КОГДА ВТ_ОбщаяТаблица.ОператорКлиники <> ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка)
			ТОГДА ВТ_ОбщаяТаблица.СуммаОплат + ВТ_ОбщаяТаблица.СуммаОплатыДолга - ЕСТЬNULL(ВТ_ОбщаяТаблица.СуммаОплатыБаллами, 0)
		ИНАЧЕ 0
	КОНЕЦ КАК ОказаноИОплаченоПоОператорам,
	NULL КАК РазбивкаПоТегам,
	ВЫБОР
		КОГДА ВТ_ОбщаяТаблица.ИсточникИнформации = ЗНАЧЕНИЕ(Справочник.ИсточникиРекламы.НаправленОт)
			ТОГДА ВТ_ОбщаяТаблица.СуммаВнесеноЗаПериод
		ИНАЧЕ 0
	КОНЕЦ КАК ВнесеноДСПоРекомендацииМенеджераСправочно
ИЗ
	ВТ_ОбщаяТаблица КАК ВТ_ОбщаяТаблица
ГДЕ
	(&ТекущийМенеджер = ЛОЖЬ
			ИЛИ ВТ_ОбщаяТаблица.ТекущийМенеджер = &ТекущийМенеджер)

СГРУППИРОВАТЬ ПО
	ВТ_ОбщаяТаблица.Отделение,
	ВТ_ОбщаяТаблица.ПостфиксНомераКарты,
	ВТ_ОбщаяТаблица.МестонахождениеКарты,
	ВТ_ОбщаяТаблица.ПациентУсловноПеривычный12,
	ВТ_ОбщаяТаблица.Пациент,
	ВТ_ОбщаяТаблица.ПериодМесяц,
	ВТ_ОбщаяТаблица.ПериодКвартал,
	ВТ_ОбщаяТаблица.ПериодГод,
	ВТ_ОбщаяТаблица.ПериодЧас,
	ВТ_ОбщаяТаблица.ТекущийМенеджерПИН,
	ВТ_ОбщаяТаблица.ПациентПервичный,
	ВТ_ОбщаяТаблица.ПланЛеченияВрачПИН,
	ВТ_ОбщаяТаблица.ДатаКарты,
	ВТ_ОбщаяТаблица.Клиника,
	ВТ_ОбщаяТаблица.КатегорияКонтрагента,
	ВТ_ОбщаяТаблица.ПериодДень,
	ВТ_ОбщаяТаблица.ПериодПолугодие,
	ВТ_ОбщаяТаблица.КоличествоПациентов,
	ВТ_ОбщаяТаблица.Сотрудник,
	ВТ_ОбщаяТаблица.ИсточникИнформации,
	ВТ_ОбщаяТаблица.ЗаписьНаПриемЗапрещена,
	ВТ_ОбщаяТаблица.НапоминатьОДнеРождения,
	ВТ_ОбщаяТаблица.ЗапретEMailРассылки,
	ВТ_ОбщаяТаблица.НомерДоговора,
	ВТ_ОбщаяТаблица.НаправленК,
	ВТ_ОбщаяТаблица.НаправленОт,
	ВТ_ОбщаяТаблица.Период,
	ВТ_ОбщаяТаблица.Услуга,
	ВТ_ОбщаяТаблица.Регистратор,
	ВТ_ОбщаяТаблица.ПациентУсловноПеривычный6,
	ВТ_ОбщаяТаблица.Артикул,
	ВТ_ОбщаяТаблица.Менеджер,
	ВТ_ОбщаяТаблица.ПериодДекада,
	ВТ_ОбщаяТаблица.ПериодНеделя,
	ВТ_ОбщаяТаблица.Ответственный,
	ВТ_ОбщаяТаблица.ОператорПИН,
	ВТ_ОбщаяТаблица.ЗапретSMSРассылки,
	ВТ_ОбщаяТаблица.Оператор,
	ВТ_ОбщаяТаблица.УточнениеИсточникаИнформации,
	ВТ_ОбщаяТаблица.ТекущийМенеджер,
	ВТ_ОбщаяТаблица.ЗапретЗвонков,
	ВТ_ОбщаяТаблица.ДатаДоговора,
	ВТ_ОбщаяТаблица.НомерЗуба,
	ВТ_ОбщаяТаблица.ПроектКЦ,
	ВТ_ОбщаяТаблица.ИсточникИнформацииОтбор,
	ВТ_ОбщаяТаблица.ЭтоПриемВрача,
	ВТ_ОбщаяТаблица.ДатаОкончанияДопСведений,
	ВТ_ОбщаяТаблица.ДатаНачалаДопСведений,
	ВТ_ОбщаяТаблица.ОплатаБольшеРавнаПорогу,
	ВТ_ОбщаяТаблица.СуммаОказаныхУслуг,
	ВТ_ОбщаяТаблица.СуммаСкидки,
	ВТ_ОбщаяТаблица.КоличествоУслуг,
	ВТ_ОбщаяТаблица.МесяцевМеждуПриемами,
	ВТ_ОбщаяТаблица.МесяцевМеждуПриемамиУВрача,
	ВТ_ОбщаяТаблица.СуммаОплат,
	ВТ_ОбщаяТаблица.СуммаОплатыДолга,
	ВТ_ОбщаяТаблица.СуммаПланаЛечения,
	ВТ_ОбщаяТаблица.Первичный,
	ВТ_ОбщаяТаблица.Наличные,
	ВТ_ОбщаяТаблица.Карта,
	ВТ_ОбщаяТаблица.Безналичные,
	ВТ_ОбщаяТаблица.СуммаВнесеноЗаПериод,
	ВТ_ОбщаяТаблица.ЦенаПлановая,
	ВТ_ОбщаяТаблица.ЦенаАгентская,
	ВТ_ОбщаяТаблица.ССПлановая,
	ВТ_ОбщаяТаблица.ССАгентская,
	ВТ_ОбщаяТаблица.СуммаОплатыБаллами,
	ВТ_ОбщаяТаблица.НомерКарты,
	ВТ_ОбщаяТаблица.Аванс,
	ВТ_ОбщаяТаблица.Задолженность,
	ВТ_ОбщаяТаблица.АвансЗадолжность,
	ВТ_ОбщаяТаблица.Остаток,
	ВТ_ОбщаяТаблица.КоличествоСмен,
	ВТ_ОбщаяТаблица.НомерСтроки,
	ВЫБОР
		КОГДА ВТ_ОбщаяТаблица.ОператорКлиники <> ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка)
			ТОГДА ВТ_ОбщаяТаблица.СуммаОплат + ВТ_ОбщаяТаблица.СуммаОплатыДолга - ЕСТЬNULL(ВТ_ОбщаяТаблица.СуммаОплатыБаллами, 0)
		ИНАЧЕ 0
	КОНЕЦ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	NULL,
	NULL,
	ВТ_ОбщаяТаблица.Пациент,
	ВТ_ОбщаяТаблица.Клиника,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	ВТ_ОбщаяТаблица.ТекущийМенеджер,
	NULL,
	NULL,
	ВТ_ОбщаяТаблица.ИсточникИнформации,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	ВТ_ОбщаяТаблица.УточнениеИсточникаИнформации,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	NULL,
	ВТ_Теги.Ссылка,
	NULL
ИЗ
	ВТ_ОбщаяТаблица КАК ВТ_ОбщаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Теги КАК ВТ_Теги
		ПО ВТ_ОбщаяТаблица.Клиника = ВТ_Теги.Клиника

СГРУППИРОВАТЬ ПО
	ВТ_ОбщаяТаблица.Клиника,
	ВТ_ОбщаяТаблица.ИсточникИнформации,
	ВТ_ОбщаяТаблица.УточнениеИсточникаИнформации,
	ВТ_ОбщаяТаблица.Пациент,
	ВТ_Теги.Ссылка,
	ВТ_ОбщаяТаблица.ТекущийМенеджер
